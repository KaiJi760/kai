/*! For license information please see sdk.cards.js.LICENSE.txt */
(()=>{var e={483:(e,t,n)=>{e.exports=function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}c=n[a]={exports:{}},t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,n,r)}return n[a].exports}for(var o=void 0,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,r){(function(e){"use strict";var n,r,i,o,a=e.MutationObserver||e.WebKitMutationObserver,s=a?(n=0,a=new a(d),r=e.document.createTextNode(""),a.observe(r,{characterData:!0}),function(){r.data=n=++n%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)}:((i=new e.MessageChannel).port1.onmessage=d,function(){i.port2.postMessage(0)}),c=[];function d(){var e,t;o=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}o=!1}t.exports=function(e){1!==c.push(e)||o||s()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var r=e(1);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function d(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&g(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){r((function(){var r;try{r=t(n)}catch(r){return o.reject(e,r)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function g(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}var a=p((function(){t(i,r)}));"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=d).prototype.catch=function(e){return this.then(null,e)},d.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(i);return this.state!==c?u(n,this.state===s?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return o.reject(e,n.value);if(n=n.value)g(e,n);else{e.state=s,e.outcome=t;for(var r=-1,i=e.queue.length;++r<i;)e.queue[r].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},d.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},d.reject=function(e){var t=new this(i);return o.reject(t,e)},d.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,c=-1,d=new this(i);++c<n;)!function(e,i){t.resolve(e).then((function(e){a[i]=e,++s!==n||r||(r=!0,o.resolve(d,a))}),(function(e){r||(r=!0,o.reject(d,e))}))}(e[c],c);return d},d.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=-1,s=new this(i);++a<n;)!function(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(s,e))}),(function(e){r||(r=!0,o.reject(s,e))}))}(e[a]);return s}},{1:1}],3:[function(e,t,r){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function d(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u="local-forage-detect-blob-support",f=void 0,g={},p=Object.prototype.toString,h="readonly",m="readwrite";function v(e){return"boolean"==typeof f?a.resolve(f):(t=e,new a((function(e){var n=t.transaction(u,m),r=o([""]);n.objectStore(u).put(r,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||43<=parseInt(t[1],10))}})).catch((function(){return!1})).then((function(e){return f=e})));var t}function b(e){e=g[e.name];var t={};t.promise=new a((function(e,n){t.resolve=e,t.reject=n})),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then((function(){return t.promise})):e.dbReady=t.promise}function y(e){return(e=g[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function I(e,t){if(e=g[e.name].deferredOperations.pop())return e.reject(t),e.promise}function w(e,t){return new a((function(n,r){if(g[e.name]=g[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);b(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var a=i.open.apply(i,o);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(u)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){n(a.result),y(e)}}))}function S(e){return w(e,!1)}function _(e){return w(e,!0)}function C(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;return r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(i||n)&&(!n||(n=e.db.version+1)>e.version&&(e.version=n),1)}function E(e){return o([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}(atob(e.data))],{type:e.type})}function x(e){return e&&e.__local_forage_encoded_blob}function T(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function D(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(0<r&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),_(e)})).then((function(){return function(e){b(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,S(e).then((function(t){return e.db=t,C(e)?_(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw I(e,t),t}))}(e).then((function(){D(e,t,n,r-1)}))})).catch(n);n(i)}}var k={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=g[n.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},g[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=T);var o=[];function s(){return a.resolve()}for(var c=0;c<i.forages.length;c++){var d=i.forages[c];d!==t&&o.push(d._initReady().catch(s))}var l=i.forages.slice(0);return a.all(o).then((function(){return n.db=i.db,S(n)})).then((function(e){return n.db=e,C(n,t._defaultConfig.version)?_(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var o=l[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!i)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){D(n._dbInfo,h,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var n,r=a.result;r?(x(n=r.value)&&(n=E(n)),void 0!==(n=e(n,r.key,s++))?t(n):r.continue()):t()},a.onerror=function(){r(a.error)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=d(e);var r=new a((function(t,r){n.ready().then((function(){D(n._dbInfo,h,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;x(e=void 0===e?null:e)&&(e=E(e)),t(e)},a.onerror=function(){r(a.error)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=d(e);var i=new a((function(n,i){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===p.call(t)?v(o.db).then((function(e){return e?t:(n=t,new a((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){D(r._dbInfo,m,(function(o,a){if(o)return i(o);try{var s=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){n(t=void 0===t?null:t)},a.onabort=a.onerror=function(){var e=c.error||c.transaction.error;i(e)}}catch(o){i(o)}}))})).catch(i)}));return s(i,n),i},removeItem:function(e,t){var n=this;e=d(e);var r=new a((function(t,r){n.ready().then((function(){D(n._dbInfo,m,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(a.error)},o.onabort=function(){var e=a.error||a.transaction.error;r(e)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){D(t._dbInfo,m,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error||o.transaction.error;n(e)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){D(t._dbInfo,h,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){e<0?t(null):n.ready().then((function(){D(n._dbInfo,h,(function(i,o){if(i)return r(i);try{var a=o.objectStore(n._dbInfo.storeName),s=!1,c=a.openCursor();c.onsuccess=function(){var n=c.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(i){r(i)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){D(t._dbInfo,h,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).openCursor(),a=[];o.onsuccess=function(){var t=o.result;t?(a.push(t.key),t.continue()):e(a)},o.onerror=function(){n(o.error)}}catch(r){n(r)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n,r=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName),s(n=e.name?(n=e.name===r.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):S(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t})),e.storeName?n.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;b(e);var r=g[e.name],o=r.forages;t.close();for(var s=0;s<o.length;s++){var c=o[s];c._dbInfo.db=null,c._dbInfo.version=n}return new a((function(t,r){var o=i.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,y(n._dbInfo)}})).catch((function(t){throw(I(e,t)||a.resolve()).catch((function(){})),t}))}})):n.then((function(t){b(e);var n=g[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new a((function(t,n){var r=i.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)y(r[t]._dbInfo)})).catch((function(t){throw(I(e,t)||a.resolve()).catch((function(){})),t}))}))):a.reject("Invalid arguments"),t),n}},A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,N="__lfsc__:",O=N.length,B="arbf",R="blob",F=O+B.length,U=Object.prototype.toString;function P(e){var t,n,r,i,o=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--),o=new ArrayBuffer(o);for(var c=new Uint8Array(o),d=0;d<a;d+=4)t=A.indexOf(e[d]),n=A.indexOf(e[d+1]),r=A.indexOf(e[d+2]),i=A.indexOf(e[d+3]),c[s++]=t<<2|n>>4,c[s++]=(15&n)<<4|r>>2,c[s++]=(3&r)<<6|63&i;return o}function $(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r+=3)n+=A[t[r]>>2],n+=A[(3&t[r])<<4|t[r+1]>>4],n+=A[(15&t[r+1])<<2|t[r+2]>>6],n+=A[63&t[r+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var j={serialize:function(e,t){var n="";if(e&&(n=U.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===U.call(e.buffer))){var r,i=N;e instanceof ArrayBuffer?(r=e,i+=B):(r=e.buffer,"[object Int8Array]"===n?i+="si08":"[object Uint8Array]"===n?i+="ui08":"[object Uint8ClampedArray]"===n?i+="uic8":"[object Int16Array]"===n?i+="si16":"[object Uint16Array]"===n?i+="ur16":"[object Int32Array]"===n?i+="si32":"[object Uint32Array]"===n?i+="ui32":"[object Float32Array]"===n?i+="fl32":"[object Float64Array]"===n?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+$(r))}else if("[object Blob]"===n)(n=new FileReader).onload=function(){var n="~~local_forage_type~"+e.type+"~"+$(this.result);t(N+R+n)},n.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,O)!==N)return JSON.parse(e);var t,n=e.substring(F),r=e.substring(O,F);r===R&&L.test(n)&&(t=(e=n.match(L))[1],n=n.substring(e[0].length));var i=P(n);switch(r){case B:return i;case R:return o([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:P,bufferToString:$};function M(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function z(e,t,n,r,i,o){e.executeSql(n,r,i,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,a):M(e,t,(function(){e.executeSql(n,r,i,o)}),o)}),o):o(e,a)}),o)}function H(e,t,n,r){var i=this;e=d(e);var o=new a((function(o,a){i.ready().then((function(){var s=t=void 0===t?null:t,c=i._dbInfo;c.serializer.serialize(t,(function(t,d){d?a(d):c.db.transaction((function(n){z(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){a(t)}))}),(function(t){t.code===t.QUOTA_ERR&&(0<r?o(H.apply(i,[e,s,n,r-1])):a(t))}))}))})).catch(a)}));return s(o,n),o}var W={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new a((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){M(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=j,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){z(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var o=r.rows,a=o.length,s=0;s<a;s++){var c=o.item(s),d=(d=c.value)&&i.serializer.deserialize(d);if(void 0!==(d=e(d,c.key,s+1)))return void t(d)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=d(e);var r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){z(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){n=(n=n.rows.length?n.rows.item(0).value:null)&&i.serializer.deserialize(n),t(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return H.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=d(e);var r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){z(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){z(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){z(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){n=n.rows.item(0).c,e(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){z(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){n=n.rows.length?n.rows.item(0).key:null,t(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){z(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r=this,i=e.name?new a((function(t){var i,o=e.name===n.name?r._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:o,storeNames:[e.storeName]}):t((i=o,new a((function(e,t){i.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).name);e({db:i,storeNames:r})}),(function(e,n){t(n)}))}),(function(e){t(e)}))}))))})).then((function(e){return new a((function(t,n){e.db.transaction((function(r){for(var i=[],o=0,s=e.storeNames.length;o<s;o++)i.push(function(e){return new a((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}(e.storeNames[o]));a.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):a.reject("Invalid arguments");return s(i,t),i}};function q(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function K(e,t){for(var n,r,i=e.length,o=0;o<i;){if((n=e[o])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return 1;o++}}e={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=q(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=j,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,o=localStorage.length,a=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var d=(d=localStorage.getItem(c))&&t.serializer.deserialize(d);if(void 0!==(d=e(d,c.substring(i),a++)))return d}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=d(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&t.serializer.deserialize(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=d(e);var i=r.ready().then((function(){var n=t=void 0===t?null:t;return new a((function(i,o){var a=r._dbInfo;a.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(a.keyPrefix+e,t),i(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}}))}))}));return s(i,n),i},removeItem:function(e,t){var n=this;e=d(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(r){t=null}return t&&t.substring(r.keyPrefix.length)}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(r=this.config(),e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n=this,r=e.name?new a((function(t){e.storeName?t(q(e,n._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):a.reject("Invalid arguments");return s(r,t),r}};var V=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Y={},G={},Q={INDEXEDDB:k,WEBSQL:W,LOCALSTORAGE:e},J=(e=[Q.INDEXEDDB._driver,Q.WEBSQL._driver,Q.LOCALSTORAGE._driver],["dropInstance"]),X=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(J),Z={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ee(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var r in n)n.hasOwnProperty(r)&&(V(n[r])?e[r]=n[r].slice():e[r]=n[r])}return e}function te(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,te),Q){var n,r;Q.hasOwnProperty(t)&&(r=(n=Q[t])._driver,this[t]=r,Y[r]||this.defineDriver(n))}this._defaultConfig=ee({},Z),this._config=ee({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}e=new(te.prototype.config=function(e){if("object"!==(void 0===e?"undefined":r(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},te.prototype.defineDriver=function(e,t,n){var r=new a((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var o=X.concat("_initStorage"),c=0,d=o.length;c<d;c++){var l=o[c];if((!K(J,l)||e[l])&&"function"!=typeof e[l])return void n(i)}!function(){for(var t=0,n=J.length;t<n;t++){var r=J[t];e[r]||(e[r]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=a.reject(t),arguments[arguments.length-1]),t}}(r))}}();var u=function(n){Y[r]&&console.info("Redefining LocalForage driver: "+r),Y[r]=e,G[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,n):u(!!e._support):u(!0)}catch(i){n(i)}}));return c(r,t,n),r},te.prototype.driver=function(){return this._driver||null},te.prototype.getDriver=function(e,t,n){return c(e=Y[e]?a.resolve(Y[e]):a.reject(new Error("Driver not found.")),t,n),e},te.prototype.getSerializer=function(e){var t=a.resolve(j);return c(t,e),t},te.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},te.prototype.setDriver=function(e,t,n){var r=this;V(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function s(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}return e=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve(),this._driverSet=e.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}o();var c=new Error("No available storage method found.");return r._driverSet=a.reject(c),r._driverSet}()}}(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=a.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},te.prototype.supports=function(e){return!!G[e]},te.prototype._extend=function(e){ee(this,e)},te.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},te.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=X.length;e<t;e++)!function(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}(this,X[e])},te.prototype.createInstance=function(e){return new te(e)},te),t.exports=e},{3:3}]},{},[4])(4)},877:(e,t,n)=>{var r=n(570),i=n(171);(n=i).v1=r,n.v4=i,e.exports=n},327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0;return[(n=t)[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[+r]]].join("")}},217:e=>{var t,n,r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);r?(t=new Uint8Array(16),e.exports=function(){return r(t),t}):(n=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n})},570:(e,t,n)=>{var r,i,o=n(217),a=n(327),s=0,c=0;e.exports=function(e,t,n){var d=t&&n||0,l=t||[],u=(e=e||{}).node||r,f=void 0!==e.clockseq?e.clockseq:i;null!=u&&null!=f||(p=o(),null==u&&(u=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==f&&(f=i=16383&(p[6]<<8|p[7])));var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=(n=void 0!==e.nsecs?e.nsecs:c+1,g-s+(n-c)/1e4);if(p<0&&void 0===e.clockseq&&(f=f+1&16383),1e4<=(n=(p<0||s<g)&&void 0===e.nsecs?0:n))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=g,i=f,n=(1e4*(268435455&(g+=122192928e5))+(c=n))%4294967296,l[d++]=n>>>24&255,l[d++]=n>>>16&255,l[d++]=n>>>8&255,l[d++]=255&n,g=g/4294967296*1e4&268435455,l[d++]=g>>>8&255,l[d++]=255&g,l[d++]=g>>>24&15|16,l[d++]=g>>>16&255,l[d++]=f>>>8|128,l[d++]=255&f;for(var h=0;h<6;++h)l[d+h]=u[h];return t||a(l)}},171:(e,t,n)=>{var r=n(217),i=n(327);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}}},t={};function n(r){var i=t[r];return void 0!==i||(i=t[r]={exports:{}},e[r](i,i.exports,n)),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{MoeCards:()=>Ze});const e="initData",t="unifiedLogs",i={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",OPTED_STATUS_TRACK_TIME:"OPTED_STATUS_TRACK_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION",DEVICE_DATA:"DEVICE_DATA",IDENTITY_MAP:"IDENTITY_MAP",SDK_VERSION:"SDK_VERSION"},o=2,a="USER_ATTRIBUTE_UNIQUE_ID",s=[a,"USER_ID_MODIFIED_FROM","USER_ATTRIBUTE_USER_EMAIL","USER_ATTRIBUTE_USER_MOBILE"],c="MOE_LIFECYCLE",d={MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED",EVENT_TRACKED:"EVENT_TRACKED",DEVICE_UUID:"DEVICE_UUID",MOE_INIT_COMPLETED:"SDK_INITIALIZATION_COMPLETED",CARDS_INIT:"CARDS_INITIALIZED",OSM_INIT:"OSM_INITIALIZED"},l="USER_LIFECYCLE",u={USER_IDENTITY_UPDATE:"USER_IDENTITY_UPDATE",LOGOUT:"LOGOUT"},f={DC_1:"sdk-01.moengage.com",DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",DC_5:"sdk-05.moengage.com",DC_6:"sdk-06.moengage.com",DC_100:"sdk-100.moengage.com",EU:"sdk-02.moengage.com",IN:"sdk-03.moengage.com"},g="tv",p="identifiers",h="moe_cards",m={STORE_NAME:"campaigns"},v={STORE_NAME:"meta",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",LAST_META_CALL_TIME:"last_meta_call_time",UNIQUE_ID:"unique_id",LAST_SYNC_CARDS:"last_sync_cards",SYNC_INTERVALS:"sync_intervals",SHOW_ALL_TAB:"show_all_tab"},b="basic",y="v1/cards/get",I="v1/cards/user",w="v1/cards/user/delete",S="categories",_="MOE_CARD_DELIVERED",C="MOE_CARD_IMPRESSION",E="MOE_CARD_CLICKED",x="MOE_CARD_DISMISSED",T="MOE_CARD_INBOX_CLICKED",D="appOpen",k="appInbox",A="moe-floating-icon-iframe",L="moe-floating-icon",N="moe-inbox",O="card-box",B="moe-card=1",R="inboxOpen",F="inboxClosed",U="cardClick",P="moe-osm-pusher";function $(e,t,n){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?$(e,t.slice(1),n):void 0===e?n||null:e:null}class j{static set(e,t){j.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return $(window,"moeInternals.ephemeral."+e,null)}static clear(){window&&(window.moeInternals={},window.moeInternals.ephemeral={})}}function M(){return window[window.moengage_object||"Moengage"]}j.baseLogTag="EphemeralStorage";class z{static logData(e,t){return{log_type:e,sent_time:(new Date).toISOString(),lake_fields:t}}static setRemoteLogging(e,t){return this.isTrackingEnabled||(this.logLevel=e,this.isTrackingEnabled=t,this.isTrackingEnabled)}static log(e,t,n,r,...i){!this.isTrackingEnabled||e!==this.logLevel&&"verbose"!==this.logLevel||M().remoteLogs.addRemoteLogs(this.logData(e,{msg:n+[...i].toString(),file_name:t,trace:r}))}}let H="color: white; background: #41AE55; border-radius: 5px;";class W{static setLogLevel(e,n){var r=W.baseLogTag+".setLogLevel";null==j.get(t)&&j.set(t,[]),null==e?W.logLevel=0:e in[0,1,2]?0<(W.logLevel=e)&&n&&W.releaseAllLogs():W.warn(0,r,"Value",e,"not supported for setDebugLevel(). Current log level is",W.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){W.tagLogStyle=W.tagLogStyle.replace("#48beab",e)}static log(e,t,n,...r){e<=W.logLevel?console.log("%c "+W.logBrand+" %c %c info %c %c "+t+" ",H,"","color: white; background: #18a0bf; border-radius: 5px;","",W.tagLogStyle,n,...r):W.cacheLog((()=>{W.log(e,t,n,...r)}))}static remoteLogTracking(e,t,n,r,...i){z.log(t,n,r,...i),this.log(e,n,r,...i)}static error(e,t,n,...r){var i;null!==(i=r[r.length-1])&&void 0!==i&&i.isCached||z.log("error",t,n,...r),e<=W.logLevel?console.error("%c "+W.logBrand+" %c %c error %c %c "+t+" ",H,"","color: white; background: #cc0a0a; border-radius: 5px;","",W.tagLogStyle,n,...r.slice(0,-1)):W.cacheLog((()=>{W.error(e,t,n,...r,{isCached:!0})}))}static warn(e,t,n,...r){var i;null!==(i=r[r.length-1])&&void 0!==i&&i.isCached||z.log("warning",t,n,...r),e<=W.logLevel?console.warn("%c "+W.logBrand+" %c %c warn %c %c "+t+" ",H,"","color: white; background: #e8ab51; border-radius: 5px;","",W.tagLogStyle,n,...r.slice(0,-1)):W.cacheLog((()=>{W.warn(e,t,n,...r,{isCached:!0})}))}static customLabel(e,t,n,...r){e<=W.logLevel?console.log("%c "+W.logBrand+" %c %c "+t+" %c %c "+n+" %c ",H,"",W.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...r):W.cacheLog((()=>{W.customLabel(e,t,n,...r)}))}static image(e,t){e<=W.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):W.cacheLog((()=>{W.image(e,t)}))}static releaseAllLogs(){var e=j.get(t),n=e.length;const r=e;if(j.set(t,[]),0<n){W.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<n;e++)r[e]();W.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){W.logBrand=e}static setBrandColor(e){H="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let n=j.get(t);null==n&&(n=[]),n.push(e),j.set(t,n)}}W.baseLogTag="Logger",W.logBrand="MoEngage",W.logLevel=0,W.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";var q,K=n(483),V=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Y{static initialize(){return V(this,void 0,void 0,(function*(){var e;return null==Y.ready&&(Y.campaignStore=K.createInstance({driver:[K.INDEXEDDB,K.WEBSQL,K.LOCALSTORAGE],name:h,storeName:m.STORE_NAME}),Y.metaStore=K.createInstance({driver:[K.INDEXEDDB,K.WEBSQL,K.LOCALSTORAGE],name:h,storeName:v.STORE_NAME}),e=[Y.campaignStore.ready(),Y.metaStore.ready()],Y.ready=Promise.all(e)),Y.ready}))}static clear(){return V(this,void 0,void 0,(function*(){var e=Y.baseLogTag+".clear";try{yield Y.initialize(),yield Promise.all([Y.campaignStore.clear(),Y.metaStore.clear()]);var t=[Y.campaignStore.ready(),Y.metaStore.ready()];Y.ready=Promise.all(t)}catch(t){W.error(1,e,"Error clearing cards stores:",t)}return Y.ready}))}}function G(){const e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}function Q(){var e=navigator.userAgent.toLowerCase(),t=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(e);return/nexus player|neo-x5|adt-2|tsbnettv|roku|tizen|smart-tv.+(samsung)|hbbtv.+maple;(\d+)|(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))|(apple) ?tv|crkey|droid.+aft(\w)( bui|\))|\(dtv[\);].+(aquos)|(aquos-tv[\w ]+)\)|(bravia[\w ]+)( bui|\))|(mitv-\w{5}) bui|Hbbtv.*(technisat) (.*);|\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)|hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)|\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i.test(e)?g:t?"tablet":G()?"mobile":"web"}Y.baseLogTag="MOE_CARDS_STORES";class J{static getListeners(){return this.listeners}static getTopicListeners(e){return $(J.topicListeners,e,[])}static addListener(e){J.listeners.push(e)}static addTopicListener(e,t){J.topicListeners[e]=J.getTopicListeners(e),J.topicListeners[e].push(t)}static broadcast(e){J.listeners.map((t=>{t(e)})),$(J.topicListeners,e.topic,[]).map((t=>{t(e)}))}static broadcastToWindow(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data||null}}))}static deprecatedSdkCallback(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))}static resetAllListeners(){J.listeners=[],J.topicListeners={}}static resetListeners(){J.listeners=[]}}J.listeners=[],J.topicListeners={};const X=J;class Z{constructor(){this.items=[]}static enqueue(e,t){e=Z.getLocalStorageQName(e);let n=new Z;te.get(e)&&(n=te.get(e)),n.items.push(t),n.items=n.items.slice(Math.max(n.items.length-50,0)),te.set(e,n)}static dequeue(e){e=Z.getLocalStorageQName(e);const t=te.get(e);let n=null;return t&&0<t.items.length&&(n=t.items[0],t.items.splice(0,1),te.set(e,t)),n}static isEmpty(e){return e=Z.getLocalStorageQName(e),!(te.get(e)&&0<te.get(e).items.length)}static purge(e){var t=Z.getLocalStorageQName(e);Z.isEmpty(e)||te.remove(t)}static getLocalStorageQName(e){return i.Q.PREFIX+"_"+e}}const ee="MOE_DATA";class te{static setPrefix(e){te.prefix=e+"_"}static set(e,t){if(te.baseLogTag,e=te.prefix+e,localStorage){const n=te.getMoeData();n[e]=t,localStorage.setItem(ee,JSON.stringify(n))}var n=te.KEYS_SHARED_WITH_COOKIE.indexOf(e);if(te.isSharedWithCookie&&0<=n){const r="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);0===n&&Array.isArray(r.attributes)&&(r.attributes=r.attributes.filter((e=>!!s.includes(e.key)))),e===i.SUBSCRIPTION_DETAILS&&(r.domain=t.domain,r.token=t.token,r.endpoint=t.endpoint,r.keys=t.keys),re.set(e,r)}}static get(e){return te.baseLogTag,e=te.prefix+e,localStorage?$(te.getMoeData(),e,null):null}static remove(e){var t=te.baseLogTag+".remove",n=te.prefix+e;if(localStorage&&null!=te.get(e)){const r=te.getMoeData();delete r[n],localStorage.setItem(ee,JSON.stringify(r)),W.log(2,t,"Key",e,"removed.")}te.isSharedWithCookie&&0<=te.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&re.remove(e)}static logout(){const e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA","DEVICE_DATA","SDK_VERSION"];for(const t in i)e.indexOf(t)<0&&te.remove(i[t]);for(const e in i.Q)Z.purge(e)}static getString(e){if(e=te.prefix+e,localStorage)return"string"==typeof(e=te.get(e))||e instanceof String?e:JSON.stringify(e)}static removePrefix(){te.prefix=""}static copyKeysFromCookie(){for(let n=0;n<te.KEYS_SHARED_WITH_COOKIE.length;n++){var e=te.KEYS_SHARED_WITH_COOKIE[n],t=re.get(e);if(null!=t){const n="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);if(e===i.USER_DATA&&(t=te.get(e)&&te.get(e).attributes,Array.isArray(n.attributes)&&Array.isArray(t)&&0<t.length)){let e=[...t];n.attributes.forEach((t=>{var n=e.findIndex((e=>e.key===t.key));0<=n?e[n]=t:e.push(t)})),e=e.filter((e=>!(s.includes(e.key)&&n.attributes.findIndex((t=>t.key===e.key))<0))),n.attributes=e}te.set(e,n)}}te.removeStaleKeysFromLS()}static removeStaleKeysFromLS(){var e=te.baseLogTag+".removeStaleKeysFromLS";try{Object.keys(te.getMoeData()).forEach((e=>{this.KEYS_SHARED_WITH_COOKIE.includes(e)&&!re.get(e)&&te.remove(e)}))}catch(t){W.error(1,e,t)}}static getMoeData(){var e=te.baseLogTag+".getMoeData",t=localStorage.getItem(ee);if(null==t)return{};try{return JSON.parse(t)}catch(t){return W.error(1,e,t),{}}}}te.baseLogTag="PersistentStorage",te.prefix="",te.isSharedWithCookie=!1,te.KEYS_SHARED_WITH_COOKIE=[i.USER_DATA,i.SUBSCRIPTION_DETAILS,i.SOFT_ASK_STATUS,i.PUSH_TOKEN,i.OPT_IN_SHOWN_TIME,i.HARD_ASK_STATUS,i.SESSION,i.DEVICE_DATA,i.IDENTITY_MAP];class ne{constructor(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=ne.baseLogTag+".constructor";null!=$(e,"app_id",null)?(this.appId=$(e,"app_id",null),this.integrationType=q.OLD_SDK):null!=$(e,"appId",null)?(this.appId=$(e,"appId",null),this.integrationType=q.NEW_SDK):(W.error(1,t,"App Id not specified. Please check docs page to complete the integration - ","https://developers.moengage.com/hc/en-us/articles/360060713252-Web-SDK-Integration"),this.integrationType=null),null!=$(e,"debug_logs",null)?this.debugLevel=$(e,"debug_logs",0):null!=$(e,"debugLevel",null)?this.debugLevel=$(e,"debugLevel",0):(W.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=$(e,"forceSwUpdate",!1),this.cluster="DC_2",this.cluster=$(e,"cluster",this.cluster),this.cluster&&null!=f[this.cluster.toUpperCase()]&&(this.environment=f[this.cluster.toUpperCase()]),$(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=$(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:$(e,"customSoftAsk.mainClass",null),allowClass:$(e,"customSoftAsk.allowClass",null),dismissClass:$(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:$(e,"main_class",null),allowClass:$(e,"allow_class",null),dismissClass:$(e,"block_class",null)},null!=$(e,"inapp.host",null)&&(this.inapp={host:$(e,"inapp.host",null)}),null!=$(e,"swScope",null)&&(this.swScope=$(e,"swScope",null)),null!=$(e,"disable_onsite",null)&&(this.disableOnsite=$(e,"disable_onsite",!1)),null!=$(e,"enableSPA",null)&&(this.enableSPA=$(e,"enableSPA",!1)),null!=$(e,"cards",null)&&(this.cards=$(e,"cards",{})),null!=$(e,"proxyDomains",null)&&(this.proxyDomains=$(e,"proxyDomains",null),this.proxyDomains.api&&(this.baseDomainName="https://"+this.proxyDomains.api+"/",this.environment=this.proxyDomains.api)),null!=$(e,"disable_web_push",null)&&(this.disableWebPush=$(e,"disable_web_push",!1)),null!=$(e,"disableCookies",null)&&(this.disableCookies=$(e,"disableCookies",!1)))}static save(t){j.set(e,new ne(t)),te.set(i.INIT_DATA,new ne(t))}static get(){return j.get(e)}}ne.baseLogTag="InitData",($e=q=q||{}).OLD_SDK="OLD_SDK",$e.NEW_SDK="NEW_SDK";class re{static set(e,t){var n;null!==(n=ne.get())&&void 0!==n&&n.disableCookies||(n=re.baseTag+".set",null==t?re.remove(e):(t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),W.log(3,n,"Setting ",e,":",t),n=Date.now(),n=";expires="+new Date(n+31536e6*o).toUTCString(),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+re.getOrigin()+";path=/;SameSite=None; Secure"))}static get(e){var t;if(null===(t=ne.get())||void 0===t||!t.disableCookies){var n=re.baseTag+".get",r=e+"=",i=re.getDecodedCookies();for(let o=i.length-1;0<=o;o--){let a=i[o];for(;" "===a.charAt(0);)a=a.substring(1);if(0===a.indexOf(r)){let i=a.substring(r.length,a.length);try{i=JSON.parse(i),"string"===$(i,"MOE_DATA_TYPE",null)?(i=$(i,"actualValue",null),i=i?String(i):null):"boolean"===$(i,"MOE_DATA_TYPE",null)&&(i=$(i,"actualValue",null))}catch(t){}return W.log(3,n,"Got ",e,":",i),i}}return null}}static remove(e){var t;null!==(t=ne.get())&&void 0!==t&&t.disableCookies||(t=re.baseTag+".remove",document.cookie=e+"=;domain="+re.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",W.log(3,t,"Removed ",e))}static setRaw(e,t,n){if(null===(r=ne.get())||void 0===r||!r.disableCookies){var r=re.baseTag+".setRaw";if(null==t)re.remove(e);else{W.log(3,r,"Setting ",e,":",t);let i="";null!=n&&(i=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+i+";domain="+re.getOrigin()+";path=/;"}}}static getOrigin(){if(null===(e=ne.get())||void 0===e||!e.disableCookies){var e=re.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(W.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}static getDecodedCookies(){const e=re.baseTag+".getDecodedCookies";return document.cookie.split(";").map((t=>{let n=t.trim();"%"===n.slice(-1)&&(n+="25");try{return decodeURIComponent(n)}catch(t){return W.error(2,e,"Error decoding cookie:",n,t),n}}))}}re.baseTag="CookieStorage";var ie=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class oe{static getIdentityMap(){var e=te.get(i.WEB_SETTINGS);return null!=e&&e.isDomainLevelStorage?this.getIdentitiesFromCookies():this.getIdentitiesFromLocalStorage()}static getIdentitiesFromLocalStorage(){var e=te.get(i.IDENTITY_MAP);return null!=e&&e.userIdentities?e:null}static getIdentitiesFromCookies(){var e=re.get(i.IDENTITY_MAP);if(e&&"object"==typeof e&&e.userIdentities){const t={userIdentities:e.userIdentities};return e.previousIdentities&&(t.previousIdentities=e.previousIdentities,t.previousIdentitiesUpdatedTime=e.previousIdentitiesUpdatedTime),t}return null}static getUserIdentities(){var e=this.getIdentityMap();return null!=e&&e.userIdentities?e.userIdentities:null}static updateCurrentUserIdentities(e){return ie(this,void 0,void 0,(function*(){let t;var n=this.getIdentityMap();t=null!=n&&n.userIdentities?Object.assign(Object.assign({},n),{userIdentities:Object.assign(Object.assign({},n.userIdentities),e)}):(this.createIdentityMap(),Object.assign(Object.assign({},this.getIdentityMap()),{userIdentities:e})),te.set(i.IDENTITY_MAP,t),yield this.updateIdentifiersIDB(t)}))}static broadcastUserIdentityUpdate(){var e=this.baseLogTag+".broadcastUserIdentityUpdate";W.log(1,e,"User Identities Updated."),X.broadcastToWindow({topic:l,name:u.USER_IDENTITY_UPDATE})}static broadcastLogout(){X.broadcastToWindow({topic:l,name:u.LOGOUT})}static updatePreviousUserIdentities(e,t){return ie(this,void 0,void 0,(function*(){let n;var r,o=this.getIdentityMap();n=null!=o&&o.userIdentities?(r=(null==o?void 0:o.previousIdentities)||{},Object.assign(Object.assign({},o),{previousIdentities:Object.assign(Object.assign({},r),e),previousIdentitiesUpdatedTime:t||(new Date).getTime()})):(this.createIdentityMap(),Object.assign(Object.assign({},this.getIdentityMap()),{previousIdentities:e,previousIdentitiesUpdatedTime:t||(new Date).getTime()})),te.set(i.IDENTITY_MAP,n),yield this.updateIdentifiersIDB(n)}))}static updateIdentifiersIDB(e){var t;return ie(this,void 0,void 0,(function*(){var n;null!==(t=this.moeDataStore)&&void 0!==t&&t.getItem||(this.moeDataStore=K.createInstance({driver:[K.INDEXEDDB],name:"moe_database",storeName:"moe_data"})),this.moeDataStore&&(Object.keys(e).length?(n=(yield this.moeDataStore.getItem(p))||{},yield this.moeDataStore.setItem(p,Object.assign(Object.assign({},n),e))):yield this.moeDataStore.setItem(p,e))}))}static copyUidIntoIdentityMap(e){var t=this.baseLogTag+".copyUidIntoIdentityMap";(e=e.getAttribute("id"))&&(this.updateCurrentUserIdentities({uid:e}),W.log(1,t,"UID copied into IdentityMap."))}static getIdentifiersFromIdentities(){var{userIdentities:e,previousIdentities:t,previousIdentitiesUpdatedTime:n}=this.getIdentityMap()||{};const r={};return e&&Object.keys(e).length&&(r.userIdentities=e),0<n&&(216e5<(new Date).getTime()-n?this.removePreviousUserIdentities():r.previousIdentities=t),r}static removePreviousUserIdentities(){return ie(this,void 0,void 0,(function*(){var e=this.baseLogTag+".removePreviousUserIdentities",t=Object.assign(Object.assign({},this.getIdentityMap()),{previousIdentities:{},previousIdentitiesUpdatedTime:0});te.set(i.IDENTITY_MAP,t),yield this.updateIdentifiersIDB(t),W.log(1,e,"previousIdentities removed from IdentityMap.")}))}static createIdentityMap(){te.set(i.IDENTITY_MAP,{userIdentities:{},previousIdentities:{},previousIdentitiesUpdatedTime:0})}}function ae(){const{deviceUuid:e,attributes:t}=te.get(i.USER_DATA);let n;return t.map((e=>{e.key===a&&(n=null===(e=e.value)||void 0===e?void 0:e.toString())})),{uniqueId:e,uid:n}}function se(){const e={};var t=oe.getIdentityMap(),n=ae();return t&&(t.userIdentities&&(e.user_identities=t.userIdentities),t.previousIdentities&&(e.previous_identities=t.previousIdentities)),n.uid&&(e.uid=n.uid),{identifiers:e,uniqueId:n.uniqueId}}function ce(e){var t;let n=e;return e=ne.get(),"string"==typeof n&&n.length&&null!==(t=null==e?void 0:e.proxyDomains)&&void 0!==t&&t.api&&(e.proxyDomains.cdnApp&&(n=n.replace(/app-cdn\.moengage\.com/gi,e.proxyDomains.cdnApp)),e.proxyDomains.cdnScript&&(n=n.replace(/cdn\.moengage\.com/gi,e.proxyDomains.cdnScript)),e.proxyDomains.cdnImage&&(n=n.replace(/image\.moengage\.com/gi,e.proxyDomains.cdnImage))),n}oe.baseLogTag="IdentityMethods";class de{constructor(e){de.baseLogTag,this.placeholder=$(e,"placeholder",""),this.enable=$(e,"enable",!1),this.overLayColor=$(e,"overLayColor","rgba(0, 0, 0, 0.8)"),this.backgroundColor=$(e,"backgroundColor","#F6FBFC"),this.navigationBar=new le($(e,"navigationBar",{})),this.closeButton=new ge($(e,"closeButton",{})),this.tab=new pe($(e,"tab",{})),this.cardDismiss=new he($(e,"cardDismiss",{})),this.optionButtonColor=$(e,"optionButtonColor","#C4C4C4"),this.dateTimeColor=$(e,"dateTimeColor","#8E8E8E"),this.unclickedCardIndicatorColor=$(e,"unclickedIndicatorColor","blue"),this.pinIcon=$(e,"pinIcon",ce("https://app-cdn.moengage.com/sdk/pin-icon.svg")),this.refreshIcon=$(e,"refreshIcon",ce("https://app-cdn.moengage.com/sdk/refresh-icon.svg")),this.webFloating=new be($(e,"webFloating",{})),this.mWebFloating=new be($(e,"mWebFloating",{countBackgroundColor:"#FF5A5F",enable:!1,icon:ce("https://app-cdn.moengage.com/sdk/bell-icon.svg"),countColor:"#fff",postion:"0px 10px 40px 0",iconBackgroundColor:"#D9DFED"})),this.card=new fe($(e,"card",{})),this.errorContent=new ue($(e,"errorContent",{})),this.noDataContent=new ye($(e,"noDataContent",{})),this.openInbox=$(e,"openInbox",(()=>{})),this.zIndex=$(e,"zIndex","999999"),this.fontFaces=(null===(e=e.fontFaces)||void 0===e?void 0:e.map((e=>new me(e))))||[]}}de.baseLogTag="CardsConfigModel";class le{constructor(e){this.backgroundColor=$(e,"backgroundColor","#00237C"),this.text=$(e,"text","Notification"),this.color=$(e,"color","#fff"),this.fontSize=$(e,"fontSize","16px"),this.fontFamily=$(e,"fontFamily","inherit")}}class ue{constructor(e={}){this.img=$(e,"img",ce("https://app-cdn.moengage.com/sdk/cards-error.svg")),this.text=$(e,"text",'Error something went wrong <button onclick="window.location.reload();" style="color: #06A6B7; display: contents;" class="btn-icon pointer-cursor" >Refresh</button>')}}class fe{constructor(e){this.headerFontSize=$(e,"headerFontSize","16px"),this.descriptionFontSize=$(e,"descriptionFontSize","14px"),this.ctaFontSize=$(e,"ctaFontSize","12px"),this.fontFamily=$(e,"fontFamily","inherit"),this.horizontalRowColor=$(e,"horizontalRowColor","#D9DFED")}}class ge{constructor(e){this.mWebIcon=$(e,"mWebIcon",ce("https://app-cdn.moengage.com/sdk/back-icon.svg")),this.webIcon=$(e,"webIcon",ce("https://app-cdn.moengage.com/sdk/cross-icon.svg")),this.callBack=$(e,"callBack",(()=>{}))}}class pe{constructor(e){this.inactiveTabFontColor=$(e,"inactiveTabFontColor","#7C7C7C"),this.fontSize=$(e,"fontSize","14px"),this.fontFamily=$(e,"fontFamily","inherit"),this.backgroundColor=$(e,"backgroundColor","#F6FBFC"),this.active=new ve($(e,"active",{}))}}class he{constructor(e){this.color=$(e,"color","red"),this.enable=$(e,"enable",!1)}}class me{constructor(e){this.family=$(e,"family",""),this.url=$(e,"url","")}}class ve{constructor(e){this.color=$(e,"color","#06A6B7"),this.underlineColor=$(e,"underlineColor","#06A6B7"),this.backgroundColor=$(e,"backgroundColor","transparent")}}class be{constructor(e){this.enable=$(e,"enable",!1),this.icon=$(e,"icon",ce("https://app-cdn.moengage.com/sdk/bell-icon.svg")),this.postion=$(e,"postion","0px 10px 40px 0"),this.countBackgroundColor=$(e,"countBackgroundColor","#FF5A5F"),this.countColor=$(e,"countColor","#fff"),this.zIndex=$(e,"zIndex","999998"),this.iconBackgroundColor=$(e,"iconBackgroundColor","#D9DFED"),this.fontFamily=$(e,"fontFamily","inherit")}}class ye{constructor(e){this.img=$(e,"img",ce("https://app-cdn.moengage.com/sdk/cards-no-result.svg")),this.text=$(e,"text","No notifications to show, check again later.")}}var Ie=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function we(){return Ie(this,void 0,void 0,(function*(){return yield Y.metaStore.getItem(v.LAST_META_CALL_TIME)}))}function Se(){return Ie(this,void 0,void 0,(function*(){return yield Y.metaStore.removeItem(v.LAST_META_CALL_TIME)}))}function _e(e,t,n){return e?t:n||""}function Ce(e){return Ie(this,void 0,void 0,(function*(){var t=e.reduce(((e,t)=>((t.displayControls.is_pin?e.pinned:e.nonPinned).push(t),e)),{pinned:[],nonPinned:[]});const n=Ee([...t.pinned]);return t=Ee([...t.nonPinned]),n.concat(t)}))}function Ee(e){return e.sort(((e,t)=>t.updatedAt-e.updatedAt))}const xe=()=>{var e=window.moengage_object||"Moengage";return window[e]},Te=()=>window.moengage_object||"Moengage";function De(){var{appId:e,baseDomainName:t}=te.get(i.INIT_DATA);return{appId:e,baseDomainName:t}}var ke=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Ae{constructor(e){this.requestId=$(e,"request_id",null),this.status=$(e,"status",!0),this.data=new Le($(e,"data",null))}static get(){return ke(this,void 0,void 0,(function*(){const e=[];return yield Y.campaignStore.iterate(((t,n)=>{e.push(t)})),e}))}static getVisibleCards(){return ke(this,void 0,void 0,(function*(){const e=[],t=(new Date).getTime();return yield Y.campaignStore.iterate((n=>{var{displayControls:r,userActivity:i}=n,{first_delivered:o,first_seen:a}=i,s=Le.getShowCount(n),{show_time:c,max_times_to_show:d,expire_after_delivered:l,expire_at:i,expire_after_seen:r}=r;"show"!==n.status||d<=s||c&&!function(e,t){const n=new Date,r=new Date(n.getTime());r.setHours(e.split(":")[0]),r.setMinutes(e.split(":")[1]);const i=new Date(n.getTime());return i.setHours(t.split(":")[0]),i.setMinutes(t.split(":")[1]),r<=n&&i>n}(null==c?void 0:c.start_time,null==c?void 0:c.end_time)||1e3*i<t||o+1e3*l<t||a+1e3*r<t||e.push(n)})),e}))}static getAllCardIds(){return ke(this,void 0,void 0,(function*(){const e=[];return yield Y.campaignStore.iterate(((t,n)=>{e.push(t.id)})),e}))}static getCategories(){return ke(this,void 0,void 0,(function*(){return yield Y.metaStore.getItem(S)}))}static showAllTabs(){return ke(this,void 0,void 0,(function*(){return yield Y.metaStore.getItem(v.SHOW_ALL_TAB)}))}}class Le{constructor(e){this.showAllTab=$(e,"show_all_tab",!0),this.cardCategories=$(e,"card_categories",[]),this.syncIntervals=new Ne($(e,"sync_intervals")),this.deletedCardIds=$(e,"deleted_card_ids",[]);const t=$(e,"cards",[]);this.cards=t.map((e=>new Oe(e)))}static getCardInfo(e){return ke(this,void 0,void 0,(function*(){return yield Y.campaignStore.getItem(e)}))}static setCardInfo(e,t){return ke(this,void 0,void 0,(function*(){return yield Y.campaignStore.setItem(e,t)}))}static removeCard(e){return ke(this,void 0,void 0,(function*(){yield Y.campaignStore.removeItem(e)}))}static getShowCount(e,t){const n=e.userActivity.show_count;return t&&n?n&&n[t]?n[t]:0:n?Object.keys(n).reduce(((e,t)=>(0<n[t]&&(e+=n[t]),e)),0):0}}class Ne{constructor(e){this.appOpen=$(e,"app_open",2700),this.appInbox=$(e,"app_inbox",300),this.pullToRefresh=$(e,"pull_to_refresh",5),this.userActivity=$(e,"user_activity",0)}static get(){return ke(this,void 0,void 0,(function*(){return yield Y.metaStore.getItem(v.SYNC_INTERVALS)}))}}class Oe{constructor(e){this.id=$(e,"id",""),this.platform=$(e,"platform","web"),this.status=$(e,"status","show"),this.category=$(e,"category",null),this.createdAt=$(e,"created_at",null),this.updatedAt=$(e,"updated_at",null),this.metaData=$(e,"meta_data"),this.templateData=new Be($(e,"template_data","")),this.userActivity=$(e,"user_activity",""),this.displayControls=$(e,"display_controls","")}}class Be{constructor(e){this.type=$(e,"type",b),$(e,"containers")&&(this.containers=JSON.parse(ce(JSON.stringify($(e,"containers")))))}}const Re="mobile"===Q();var Fe=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Ue{constructor(){this.mWeb="mobile"===Q(),this.baseLogTag="cardHtmlCss",this.cardsCategories=[],this.cardsConfig=new de(Object.assign({},ne.get().cards))}init(){return Fe(this,void 0,void 0,(function*(){this.cardsCategories=(yield Ae.showAllTabs())?["All"].concat(yield Ae.getCategories()):yield Ae.getCategories(),this.cards=(yield Ae.getVisibleCards())||[],this.isError=this.isErrorPage()}))}cardFrame(){return Fe(this,void 0,void 0,(function*(){return`<html>\n      <head>\n        <style>\n        ${this.getFontFaces()}\n        ${(e=>{var{backgroundColor:t,tab:n,navigationBar:r,unclickedCardIndicatorColor:i,pinIcon:o,cardDismiss:a,dateTimeColor:s,optionButtonColor:c,card:d}=e,{headerFontSize:l,descriptionFontSize:u,ctaFontSize:f,fontFamily:e,horizontalRowColor:d}=d;return`\n  body {\n    font-family: 'Helvetica Neue', Helvetica, Arial, Roboto, sans-serif, sans-serif;\n    font-size: 14px;\n    margin: 0px;\n  }\n  a {\n    text-decoration: none;\n    color: black;\n  }\n  p, h3 {\n    margin: 0px;\n  }\n  h3 {\n    font-size: 16px;\n  }\n  .flex-column {\n    display: flex;\n    flex-direction: column;\n  }\n  .flex-row {\n    display: flex;\n    flex-direction: row;\n  }\n  .hr-style {\n    border: 0.5px solid ${d};\n    width: calc(100% - 16px);\n    margin: 0px auto;\n  }\n  .card-content > div {\n    padding-bottom: 16px;\n  }\n  .card-style-baisc {\n    padding: 16px 16px 0px 16px;\n    gap: 16px\n  }\n  .card-style-illustration {\n    padding: 24px 16px 0px 16px;\n    gap: 8px;\n  }\n  .color-white {\n    color: #fff;\n  }\n  @keyframes slideIn {\n    from { right: ${Re?"-100%":"-423px"};\n    }\n      to {\n        right: 0px\n      }\n    }\n    @keyframes slideOut {\n    from {\n      right: 0px;\n    }\n      to {\n        right: ${Re?"-100%":"-423px"};\n      }\n    }\n  .container-width {\n    width: ${Re?"100%":"423px"};\n  }\n  .${O} {\n    position: fixed;\n    right: 0px;\n    height: 100vh;\n    animation-duration: 0.5s;\n    animation-fill-mode: forwards;\n    display: flex;\n    flex-direction: column;\n  }\n  .cards-container-background {\n    background: ${t};\n  }\n  .cards-container {\n    width: 100%;\n    position: absolute;\n    right: 0px;\n    height: 100%;\n    overflow: auto;\n    font-family: ${e};\n  }\n  .card-box-animation {\n    width: 100%;\n    animation-duration: 0.5s;\n    animation-fill-mode: forwards;\n    position: relative;\n  }\n  .tab {\n    display: flex;\n    overflow: auto;\n    background-color: ${(null==n?void 0:n.backgroundColor)||"#fff"};\n    font-family: ${(null==n?void 0:n.fontFamily)||"inherit"};\n    font-size: ${(null==n?void 0:n.fontSize)||"14px"};\n    color: ${(null==n?void 0:n.inactiveTabFontColor)||"#7C7C7C"};\n    font-style: normal;\n    font-weight: 400;\n    line-height: 17px;\n  }\n  .tab::-webkit-scrollbar {\n    display: none;\n  }\n  .tab {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  .tab button {\n    background-color: inherit;\n    font-family: inherit;\n    color: inherit;\n    font-size: inherit;\n    float: left;\n    border: none;\n    outline: none;\n    padding: 14px 16px;\n    transition: 0.3s;\n    position: relative;\n  }\n  .tab-links.active {\n    color: ${null===(e=null==n?void 0:n.active)||void 0===e?void 0:e.color};\n    background-color: ${null===(e=null==n?void 0:n.active)||void 0===e?void 0:e.backgroundColor}\n  }\n  .under-line.active {\n    position: absolute;\n    width: calc(100% - 32px);\n    border-bottom: 2px solid ${null===(n=null==n?void 0:n.active)||void 0===n?void 0:n.underlineColor};\n    bottom: 0;\n  }\n  .navigation-bar{\n    max-width: 300px;\n    background-color: ${null==r?void 0:r.backgroundColor};\n    color: ${null==r?void 0:r.color};\n    font-size: ${null==r?void 0:r.fontSize};\n    font-family: ${null==r?void 0:r.fontFamily};\n  }\n  .close-btn img{\n    background-color: 'transparent';\n  }\n  .btn-icon {\n    background: transparent;\n    padding: 0;\n    border: none;\n    display: flex;\n  }\n  .card-header {\n    height: 54px;\n    background-color: #00237C;\n    align-items: center;\n    padding: 0px 16px;\n    border-radius: ${_e(Re,"0px","10px 0px 0px 0px")};\n    justify-content: space-between;\n  }\n  .mobile-header {\n    flex-direction: row-reverse !important;\n    justify-content: flex-end;\n    background-color: #fff;\n  }\n  .mobile-header span {\n    padding-left: 15px;\n    background-color: inherit;\n  }\n  .unclicked-indicator-color {\n    background-color: ${i};\n    width: 8px;\n    height: 8px;\n    border-radius: 8px;\n    margin: 4px;\n    position: absolute;\n    top: 26px;\n  }\n  .dismiss-btn {\n    color: ${a.color};\n  }\n  .card-footer {\n    padding: 16px 16px 8px 16px;\n    display: flex;\n    justify-content: space-between;\n  }\n  .footer {\n    font-size: 12px;\n  }\n  .date-time {\n    color: ${s};\n    font-style: normal;\n    font-weight: 400;\n    font-size: 12px;\n    line-height: 15px;\n  }\n  .view {\n    color: #06A6B7;\n    font-size: 14px;\n  }\n  .card-content-spacing {\n    gap: 8px;\n    width: -moz-available;\n    width: -webkit-fill-available;\n    width: fill-available;\n    overflow: hidden;\n  }\n  .card-content-with-img-spacing {\n    gap: 8px;\n    width: 80%;\n  }\n  .error-container {\n    padding: 0px 50px;\n  }\n  .error-img {\n    width: 100%;\n  }\n  .cta-view {\n    display: -webkit-box;\n    max-width: 200px;\n    font-size: ${f};\n  }\n  .error-text {\n    font-style: normal;\n    font-weight: 400;\n    font-size: 13px;\n    line-height: 16px;\n    display: -webkit-box;\n    line-break: anywhere;\n    font-size: 14px;\n    -webkit-line-clamp: 5;\n    line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n  .cta-view > div, .card-text > div {\n    word-wrap: break-word;\n  }\n  .card-text {\n    display: -webkit-box;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .remove-pointer-event {\n    pointer-events: none;\n  }\n  .single-line-text {\n    -webkit-line-clamp: 1;\n            line-clamp: 1;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .card-text-header {\n    font-style: normal;\n    font-weight: 700;\n    line-height: 20px;\n    font-size: ${l};\n  }\n  .card-text-description {\n    font-style: normal;\n    font-weight: 400;\n    line-height: 17px;\n    font-size: ${u};\n  }\n  .three-line-text {\n    -webkit-line-clamp: 3;\n    line-clamp: 3;\n    -webkit-box-orient: vertical;\n  }\n  .img-illustration {\n    max-width: ${Re?"100%":"390px"};\n    height: 164px;\n    border-radius: 2px;\n  }\n  .img-basic {\n    width: 60px;\n    height: 60px;\n    border-radius: 2px;\n  }\n  .card-img-container {\n    -webkit-box-pack: center;\n    -webkit-justify-content: center;\n    -ms-flex-pack: center;\n    justify-content: center;\n    -webkit-align-items: center;\n    -webkit-box-align: center;\n    -ms-flex-align: center;\n    align-items: center;\n    background-color: unset;\n  }\n  .card-img-cover {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n  .card-img-contain {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n  }\n  .card-text-event > div {\n    pointer-events: none;\n  }\n  .extra-icon {\n    display: flex;\n    position: absolute;\n    right: 0;\n  }\n  .pin-icon {\n    content: url(${o});\n  }\n  .extras span {\n    width: 6px;\n    height: 6px;\n    background-color: ${c};\n    border-radius: 6px;\n    margin: 2px;\n  }\n  .extras {\n    display: flex;\n    padding: 5px 8px 0px 4px;\n    border: none;\n    background: transparent;\n  }\n  .pointer-cursor {\n    cursor: pointer;\n  }\n  .moe-more-options {\n    position: absolute;\n    z-index: 1;\n    right: 0;\n    top: 18px;\n    padding-right: 5px;\n    display: none;\n    list-style: none;\n    margin: 0px;\n  }\n  .more-opt-btn {\n    padding: 5px;\n    width: 65px;\n    height: 30px;\n    justify-content: center;\n    color: #7C7C7C;\n    border: 0px solid;\n    background: #FFFFFF;\n    box-shadow: 1px 4px 10px rgb(201 201 201 / 50%);\n    border-radius: 4px 4px 10px 10px;\n  }\n  .center-align {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .loader {\n    -webkit-animation:spin 4s linear infinite;\n    -moz-animation:spin 4s linear infinite;\n    animation:spin 4s linear infinite;\n  }\n  @-moz-keyframes spin {\n      100% { -moz-transform: rotate(360deg); }\n  }\n  @-webkit-keyframes spin {\n      100% { -webkit-transform: rotate(360deg); }\n  }\n  @keyframes spin {\n      100% {\n          -webkit-transform: rotate(360deg);\n          transform:rotate(360deg);\n      }\n  }\n  `})(this.cardsConfig)}\n        </style>\n        <script>\n        ${this.cardFrameScript()}\n        ${this.cardExtraScript()}\n        ${this.notificationHeaderScript()}\n        ${this.tabButtonsScript()}\n        <\/script>\n      </head>\n      <body ${_e(!this.isError,'onload="load()"')}>\n      <div id="${O}" class="${O} container-width"\n      style="animation-name: slideIn;">\n        ${this.notificationHeader()}\n        <div style="position: relative; height: 100%;">\n        <div\n        id="cards-container"\n        class="cards-container cards-container-background"\n        >\n          ${_e(!this.isError,this.cardsTab())}\n          ${this.isError||""}\n        </div>\n        </div>\n      </div>\n      ${this.insertBannerDiv()}\n      </body>\n      </html>`}))}cardFrameScript(){var e;return`\n    let impressionedCards = {}\n    let lastScrollTop = 0;\n    let startImpression = 0;\n    let endImpression = 0;\n    function debounce(func, timeout = 100){\n      let timer;\n      return (...args) => {\n        clearTimeout(timer);\n        timer = setTimeout(() => { func.apply(this, args); }, timeout);\n      };\n    }\n    window.impressionEventTrack = debounce(() => cardsInView(),300)\n\n    function isCardIntoView(elem) {\n      const mainFrame = document.getElementById("cards-container");\n      const docViewTop = mainFrame.scrollTop;\n      const docViewBottom = docViewTop + mainFrame.offsetHeight + 1;\n      const elemTop = elem.offsetTop;\n      const elemBottom = elemTop + elem.offsetHeight;\n      return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\n    }\n    async function sendImpressionEvent(){\n      if(startImpression === endImpression)\n        return;\n\n      for(let i=startImpression; i<endImpression; i++){\n        if(!impressionedCards[categoryData[i].id]){\n          impressionedCards[categoryData[i].id] = true\n          await window.parent.${Te()}.cards.cardShown(categoryData[i].id);\n        }\n      }\n    }\n    function cardsInView() {\n      let flag = false;\n      const tabName = document.querySelectorAll('.tab > .active');\n      for(let i= startImpression; i< categoryData.length; i++){\n        if(isCardIntoView(document.getElementById("card-"+ tabName[0].name + "-" + categoryData[i].id)) && !impressionedCards[categoryData[i]?.id]){\n          endImpression = i + 1;\n          flag = true;\n        }\n        else if(flag){\n          endImpression = startImpression !== endImpression ? i : i + 1;\n          flag = false;\n        }\n      }\n      sendImpressionEvent();\n    }\n\n    async function load()\n    {\n      await openNotification(event, '${null===(e=this.cardsCategories)||void 0===e?void 0:e[0]}');\n      const tabUnderLine = document.querySelectorAll(".under-line");\n      const tabLinks = document.querySelectorAll(".tab-links");\n      if(tabUnderLine && tabUnderLine[0] && tabUnderLine[0].className){\n        tabUnderLine[0].className += " active";\n      }\n      if(tabLinks && tabLinks[0] && tabLinks[0].className){\n        tabLinks[0].className += " active";\n      }\n      window.onpageshow = function(event) {\n        if (event.persisted) {\n            window.location.reload();\n        }\n      };\n      impressionEventTrack()\n      document.getElementById("cards-container").addEventListener("scroll", (evt)=> {\n        let st = evt.target.pageYOffset || evt.target.scrollTop;\n        if (st >= lastScrollTop){\n          impressionEventTrack();\n        }\n        lastScrollTop = st;\n      });\n      document.querySelector(".moe-card-tab").addEventListener('click',(e)=> {\n        const target =  e.target;\n        if(target.classList && target.classList.contains('tab-links')){\n            openNotification(event,target.name);\n          }\n      });\n    }\n    `}getFontFaces(){const e=this.cardsConfig.fontFaces;return null==e?void 0:e.map((e=>`\n      @font-face {\n        font-family: ${e.family};\n        src: url(${e.url});\n      }`)).join("")}getFloatingIconButton(e,t){if(e){var{icon:n,countColor:r,countBackgroundColor:i,iconBackgroundColor:o,fontFamily:e}=e;return`<html>\n    <head>\n    <style>\n    ${this.getFontFaces()}\n    .new-notifications {\n      display: flex;\n      top: 10px;\n      font-size: 10px;\n      left: 40px;\n      align-items: center;\n      justify-content: center;\n      width: 20px;\n      height: 20px;\n      border-radius: 50%;\n      border: 1px solid ${i};\n      background: ${i};\n      color: ${r};\n      font-family: ${e};\n    }\n    .floatingIcon {\n      cursor: pointer;\n      width: 60px;\n      height: 60px;\n      margin: 10px 1px 1px 1px;\n      border-radius: 50%;\n      background: ${o};\n      box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.15);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    body {\n      margin: 0;\n    }\n    </style>\n    </head>\n      <body>\n      <div class="floatingIcon"\n        id="${L}"\n        >\n      <img src="${n}" style="height: 32px;" />\n      <span id="moe-floating-notifications"  style="position: absolute;" class="new-notifications">${99<t?"99+":t}</span>\n      </div>\n      </body>\n      </html>\n    `}}cardBody(e,t){const{widgets:n,style:r,id:i}=e.templateData.containers[0];let o="",a="",s="";n.map((t=>{"image"===t.type&&(o+=this.cardImage(t,e.templateData.type)),"text"===t.type&&(a+=this.cardText(t,""===a)),"button"===t.type&&(s=this.cardButton(t,null==e?void 0:e.id))}));var c="basic"===e.templateData.type&&!!o;return`<div id="card-${t}-${null==e?void 0:e.id}" class="card-box-animation" data-moe-widget-id="${i}">\n      <div style="${_e(r.bgColor,`background-color: ${r.bgColor};`)} position: relative;">\n        ${this.cardExtraButtons(e,t)}\n        <${_e(null===(t=null===(t=null==e?void 0:e.templateData)||void 0===t?void 0:t.containers[0].actions[0])||void 0===t?void 0:t.value,`a href=${null===(t=null===(t=null==e?void 0:e.templateData)||void 0===t?void 0:t.containers[0].actions[0])||void 0===t?void 0:t.value} target="_blank"`,'div class="pointer-cursor"')} onclick="cardClicked(event, '${e.id}')">\n          ${_e(!e.userActivity.is_clicked,this.isClickedIndicators(null==e?void 0:e.id))}\n          <div class="card-data ${_e("basic"===e.templateData.type,"flex-row card-style-baisc","flex-column card-style-illustration")}" style="${_e(e.displayControls.is_pin&&"basic"===e.templateData.type,"padding-top: 24px;")}">\n            ${o}\n            ${this.cardTextWrapper(e.templateData.type,a,c)}\n          </div>\n        </${_e(null===(c=null===(c=null==e?void 0:e.templateData)||void 0===c?void 0:c.containers[0].actions[0])||void 0===c?void 0:c.value,"a","div")}>\n        ${this.cardFooter((c=1e3*e.updatedAt,new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"})+", "+new Date(c).toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}).replace(":",".").toLowerCase()),s)}\n      </div>\n      <hr noshade class="hr-style"/>\n    </div>`}cardsTab(){var e;return""+(null===(e=this.cardsCategories)||void 0===e?void 0:e.map((e=>`<div id="${e}" class="tab-content"></div>`)).join(""))}isErrorPage(e){if(this.cardsConfig){if("errorContent"===e){var{img:t,text:n}=this.cardsConfig.errorContent;return this.errorPage(t,n,e)}if(0===(null===(t=this.cards)||void 0===t?void 0:t.length)||!this.cards||"noDataContent"===e){var{img:n,text:t}=this.cardsConfig.noDataContent;return this.errorPage(n,t,e)}}return!1}cardExtraScript(){return`\n    function deleteCard(id, cardsCategory, tabName){\n      const result = window.parent.${Te()}.cards.deleteCard(id);\n      const cards = document.querySelectorAll('#card-'+tabName+'-'+id);\n        cards.forEach((card)=> {\n          card.style.animationName = 'slideOut'\n          card.addEventListener(\n            'animationend',\n            async () => {\n              card.style.display = 'none';\n              await openNotification('', tabName);\n            },\n            { once: true },\n          );\n        });\n    }\n    function moreOptions (cardId, tabName) {\n      const id = 'moe-more-options-' + tabName + '-' + cardId;\n      const moreOption = document.getElementById(id);\n      if(moreOption) {\n        moreOption.style.display = moreOption.style.display === 'none' ? 'block' : 'none';\n      }\n    }\n    async function cardClicked (event, cardId, eventTrack = true){\n      const widgetId = event.target.getAttribute('data-moe-widget-id') || null;\n      const result = await window.parent.${Te()}.cards.cardClicked(cardId, widgetId, eventTrack);\n      window.parent.${Te()}.cards.listeners['${U}'] &&\n          window.parent.${Te()}.cards.listeners['${U}'](cardId);\n      if(result){\n        const cards = document.querySelectorAll('#unclicked-indicator-'+cardId);\n        cards.forEach((card)=> {\n          card.remove();\n        });\n      }\n    }\n    `}cardExtraButtons(e,t){var n=this.cardsConfig.cardDismiss;return`<div class="extra-icon">\n      ${_e(e.displayControls.is_pin,'<img class="pin-icon extras pointer-cursor" width="12px" />')}\n      ${_e(null==n?void 0:n.enable,`<button class="extras pointer-cursor" onclick="moreOptions('${e.id}','${t}')">\n          <span></span>\n          <span></span>\n          <span></span>\n        </button>`)}\n    </div>\n    `+_e(null==n?void 0:n.enable,`<ul id="moe-more-options-${t}-${e.id}" class="moe-more-options" style="display: none;">\n        <li><button class="more-opt-btn pointer-cursor" id="delete-card" onclick="deleteCard('${e.id}','${e.category}', '${t}')"><span class="dismiss-btn">Delete</span></button><li>\n      </ul>`)}cardImage(e,t){var{style:n,content:r,id:e}=e;return`<div class="img-${t} card-img-container" style="background-color: ${null==n?void 0:n.bgColor}; text-align: center;" data-moe-widget-id="${e}">\n    <img alt="card-icon" class="remove-pointer-event card-img-cover" src="${r}" />\n    </div>`}cardTextWrapper(e,t,n=!1){return`<div class="flex-column ${n?"card-content-with-img-spacing":"card-content-spacing"}">${t}</div>`}cardText(e,t){var{id:n,style:r,content:e}=e;return`\n    <div data-moe-widget-id="${n}" class="${t?"card-text-header card-text single-line-text":"card-text-description card-text three-line-text"} card-text-event" style="font-size: ${null==r?void 0:r.fontSize}px; color: ${null==r?void 0:r.bgColor};">\n      ${e||""}\n    </div>`}cardButton(e,t){var{id:n,content:r,actions:i}=e;return null!==(e=i[0])&&void 0!==e&&e.value?`<a data-moe-widget-id="${n}" class="cta-view single-line-text" id="${t}-button" href="${null===(i=i[0])||void 0===i?void 0:i.value}" onclick="cardClicked(event, '${t}', false)" target="_blank">${r}</a>`:`<div data-moe-widget-id="${n}" class="pointer-cursor cta-view single-line-text" id="${t}-button">${r}</div>`}cardFooter(e,t){return`<div class="card-footer"><span class="footer date-time">${e}</span> ${t||""}</div>`}isClickedIndicators(e){return`<div id="unclicked-indicator-${e}" class="unclicked-indicator-color"></div>`}addStyle(e,t){return t?e+": "+t:""}conditionValue(e,t,n){return e?t:n||""}notificationHeaderScript(){var e=this.cardsConfig.closeButton;return`\n    async function closeIframe () {\n      const close = ${null==e?void 0:e.callBack}\n      close();\n      impressionedCards = {};\n      const cardSlider = document.getElementById('${O}');\n      cardSlider.addEventListener(\n        'animationend',\n        () => {\n          if(${!1!==this.isError}){\n            window.parent.cardAPI.closeCardsFrame('${N}', true);\n          } else {\n            window.parent.cardAPI.closeCardsFrame('${N}');\n          }\n        },\n        { once: true },\n      );\n      if(cardSlider) {\n        cardSlider.style.animationName = "slideOut";\n        const cardFrame = window.parent.document.getElementById('${N}');\n        if(cardFrame.style){\n          cardFrame.style.opacity = "0";\n        }\n      }\n    }\n    function startLoader () {\n      const refreshIcon = document.getElementById('moe-notification-refresh');\n      refreshIcon.className += "loader";\n    }\n    function stopLoader () {\n      const refreshIcon = document.getElementById('moe-notification-refresh');\n      refreshIcon.className = refreshIcon.className.replace("loader", "")\n    }\n    async function syncCampaigns () {\n      startLoader();\n      window.parent.document.getElementById('${N}').setAttribute("data-moe-refresh", true);\n      await window.parent.${Te()}.cards.refreshCards();\n      await syncCampaignLocaly()\n      stopLoader();\n    }\n    async function syncCampaignLocaly () {\n      window.parent.document.getElementById('${N}').removeAttribute("data-moe-refresh");\n      const tabName = document.querySelectorAll('.tab > .active');\n      if(tabName && tabName[0]){\n        await openNotification('', tabName[0].name);\n      }\n    }\n    `}notificationHeader(){var e=this.cardsConfig.navigationBar;return`<div>\n      <div\n        style="${this.addStyle("background-color",null==e?void 0:e.backgroundColor)}"\n        class="flex-row card-header">\n        ${_e(this.mWeb,this.mWebHeader(),this.webHeader())}\n      </div>\n      ${_e(!this.isError&&1<=this.cardsCategories.length,this.tabButtons()+'<div class="cards-container-background"><hr noshade class="hr-style"/></div>')}\n\n    </div>`}webHeader(){var{navigationBar:e,refreshIcon:t,closeButton:n}=this.cardsConfig,n=n.webIcon;return`<span class="navigation-bar single-line-text" >${null==e?void 0:e.text}</span>\n    <div class="flex-row" style="align-items: center;">\n      <button class="btn-icon pointer-cursor center-align" onclick="syncCampaigns()" style="margin: 0px 5px; position: relative;">\n      <img src="${t}" style="position: absolute;" id="moe-notification-refresh" />\n        </button>\n      <button class="btn-icon close-btn pointer-cursor" onclick="closeIframe()">\n        <img src="${n}" style="max-width: 16px; padding-left: 16px;" />\n      </button>\n    </div>`}mWebHeader(){var e,{navigationBar:t,refreshIcon:n,closeButton:e}=this.cardsConfig;return`<div class="flex-row" style="align-items: center;">\n      <button class="btn-icon close-btn pointer-cursor" onclick="closeIframe()">\n        <img src="${e=e.mWebIcon}" style="max-width: 16px;" />\n      </button>\n      <span class="navigation-bar single-line-text" style="padding-left: 16px;">\n        ${null==t?void 0:t.text}\n      </span>\n      </div>\n      <button class="btn-icon pointer-cursor center-align" onclick="syncCampaigns()" >\n        <img src="${n}" id="moe-notification-refresh"  style=" position: absolute;" />\n      </button>`}tabButtonsScript(){return`\n    let categoryData = []\n    async function openNotification(evt, tabName) {\n      lastScrollTop = 0;\n      startImpression = 0;\n      endImpression = 0;\n      categoryData = await window.parent.${Te()}.cards.getVisibleCardsForCategory(tabName);\n      const selectTab = document.getElementById(tabName);\n      let innerData;\n      if(categoryData.length > 0){\n        innerData =  await window.parent.cardAPI.cardsTabData(categoryData, tabName);\n      }\n      else {\n        innerData =  await window.parent.cardAPI.getErrorPage('noDataContent');\n      }\n      if(selectTab){\n        selectTab.innerHTML = innerData;\n      }\n      let i, tabContent, tabLinks, tabBorder;\n      tabContent = document.querySelectorAll(".tab-content");\n      tabContent.forEach((tab) => tab.style.display = "none")\n      if(evt){\n        tabBorder = document.querySelectorAll(".under-line");\n        tabBorder.forEach((border) => border.className = border.className.replace(" active", ""));\n        tabLinks = document.querySelectorAll(".tab-links");\n        tabLinks.forEach((links) => links.className = links.className.replace(" active", ""));\n      }\n      const notificationName = document.getElementById(tabName)\n      if(notificationName){\n        notificationName.style.display = "contents";\n      }\n      if(evt){\n        evt.target.childNodes.forEach((res) => res.className += " active");\n        evt.target.className += " active";\n      }\n      impressionEventTrack()\n    }\n    `}tabButtons(){var e;return`<div class="tab moe-card-tab">\n    ${null===(e=this.cardsCategories)||void 0===e?void 0:e.map((e=>`<button class="tab-links pointer-cursor" name="${e}"><div class="single-line-text remove-pointer-event" style="max-width: 200px;">${e}</div><div class="under-line"></div></button>`)).join("")}\n    </div>`}errorPage(e,t,n){return`\n      <div class="error-container" style="height: ${n?"calc(100% - 150px);":"calc(100% - 55px);"} display: flex; justify-content: center; flex-direction: column;text-align: center;">\n        <div>\n          <img class="error-img" src=${e} />\n        <div>\n        <span class="error-text">${t}</span>\n      </div>`}insertBannerDiv(){return`\n    <script>\n     const element = window.parent.document.getElementById('moe-osm-pusher');\n     element && document.body.insertBefore(element.cloneNode(true),document.getElementById('${O}'))\n    <\/script>\n    `}}var Pe,$e,je=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Me{constructor(){this.isMweb="mobile"===Q();var e=Me.baseLogTag+".constructor";this.cardsConfig=new de(Object.assign({},ne.get().cards)),this.initialBodyStyle=Object.assign({},window.getComputedStyle(document.body)),this.cardHtmlCss=new Ue,W.log(1,e,"Using the cards config: ",this.cardsConfig)}initialize(){return je(this,void 0,void 0,(function*(){var e=Me.baseLogTag+".initialize",{mWebFloating:t,webFloating:n}=this.cardsConfig;let r;window.cardAPI=Object.assign({},window.cardAPI),this.isMweb&&null!=t&&t.enable?(this.floatingIcon=t,r=yield this.renderFloatingIcon(t)):!this.isMweb&&null!=n&&n.enable&&(this.floatingIcon=n,r=yield this.renderFloatingIcon(n)),this.addCardsInboxListener(),W.log(1,e,"Notification Buttons and Floating Icons Created")}))}addCardsInboxListener(){const e=Me.baseLogTag+".addCardsInboxListener";this.cardsConfig.placeholder&&document.querySelectorAll(this.cardsConfig.placeholder).forEach((t=>{t.dataset.moeCardsInboxListener||(t.addEventListener("click",(t=>je(this,void 0,void 0,(function*(){return W.log(1,e,"Notification Button Clicked"),t.stopImmediatePropagation(),yield this.openInbox()})))),t.dataset.moeCardsInboxListener="true")}))}openInbox(){return je(this,void 0,void 0,(function*(){yield this.startRendering(),xe().cards.inboxOpened(),xe().cards.listeners[R]&&xe().cards.listeners[R]()}))}closeInbox(){xe().cards.listeners[F]&&xe().cards.listeners[F]()}createFloatingIcon(e){return je(this,void 0,void 0,(function*(){var t=Me.baseLogTag+".createFloatingIcon";W.log(2,t,"Floating Icon found for cards: ",e),t=yield xe().cards.getUnClickedCardCount();const{postion:n,zIndex:r}=e;let[i,o,a,s]=n.split(" ");t=this.cardHtmlCss.getFloatingIconButton(e,t);const c=this.createDefaultIframe(A,t);return c.style.width="65px",c.style.height="76px",i&&0!==parseInt(i)||(c.style.zIndex=r,i="auto"),o&&0!==parseInt(o)||(o="auto"),a&&0!==parseInt(a)||(a="auto"),s&&0!==parseInt(s)||(s="auto"),c.style.top=i,c.style.right=o,c.style.bottom=a,c.style.left=s,c}))}renderFloatingIcon(e){return je(this,void 0,void 0,(function*(){if(document.getElementById(A))this.updateFloatingIcon();else{const t=yield this.createFloatingIcon(e);if("FRAMESET"===document.body.nodeName){const e=document.head;e.parentNode.insertBefore(t,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(t,e)}t.onload=()=>{t.contentDocument.getElementById(L).addEventListener("click",(e=>je(this,void 0,void 0,(function*(){e.stopImmediatePropagation(),yield this.openInbox()}))))}}}))}getCardsTab(e,t){return e.map((e=>this.cardHtmlCss.cardBody(e,t))).join("")}getErrorPage(e){return this.cardHtmlCss.isErrorPage(e)}updateURL(){var e,t,n=Me.baseLogTag+".updateURL";history.pushState&&this.isMweb&&(window.location.href.includes(B)?window.history.back():(window.location.href,e=""===window.location.search?"?":"&",t=window.location.href+e+B,window.history.pushState({path:t},"",t),W.log(1,n,`URL changed to ${t} since its a mobile web to handle close of inbox on back button.`)))}mWebBackButtonClick(){window.addEventListener("popstate",(()=>{var e,t=window.parent.document.getElementById(N);if(t&&"none"!==(null===(e=t.style)||void 0===e?void 0:e.display)&&G()){const e=null==t?void 0:t.contentWindow;e&&e.closeIframe&&e.closeIframe()}}),{once:!0})}startRendering(){return je(this,void 0,void 0,(function*(){var e=Me.baseLogTag+".startRendering";this.updateURL(),this.mWebBackButtonClick(),W.log(1,e,"Cards Data and Cards Categories Fetch");const t=document.getElementById(N);if(t){W.log(2,e,"Existing iframe for inbox found, just showing it.");const n=t.contentDocument||t.contentWindow.document;return n&&n.getElementById(O)&&(this.updateCardsData(),n.getElementById(O).style.animationName="slideIn",t.style.display="block",t.style.animationName="fadeIn",ze.setScrollState(this.initialBodyStyle,!0)),t.contentWindow&&t.contentWindow.impressionEventTrack(),null}yield this.createIFrame(),ze.setScrollState(this.initialBodyStyle,!0)}))}updateFloatingIcon(){var e;return je(this,void 0,void 0,(function*(){var t=Me.baseLogTag+".updateFloatingIcon",n=yield null===(e=xe().cards)||void 0===e?void 0:e.getUnClickedCardCount();n=this.cardHtmlCss.getFloatingIconButton(this.floatingIcon,n);const r=document.getElementById(A);r&&n&&(W.log(2,t,"Update Card Frame"),r.srcdoc=n)}))}updateCardsData(){return je(this,void 0,void 0,(function*(){var e=Me.baseLogTag+".updateCardsData";null!=this&&this.cardHtmlCss&&(yield null==this?void 0:this.cardHtmlCss.init());var t=yield this.cardHtmlCss.cardFrame();const n=document.getElementById(N);n&&n.getAttribute("data-moe-refresh")&&n.contentWindow?n.contentWindow.syncCampaignLocaly():n&&t&&(W.log(2,e,"Update Card Frame"),n.srcdoc=t)}))}closeIframe(e){var t=Me.baseLogTag+".closeIframe";const n=document.getElementById(N);if(n)if(W.log(2,t,"Inbox closed"),this.closeInbox(),ze.setScrollState(this.initialBodyStyle),e)n.remove();else{"none"!==n.style.display&&(n.style.display="none",n.style.opacity="1"),(null!==(e=this.cardsConfig.mWebFloating)&&void 0!==e&&e.enable||null!==(e=this.cardsConfig.webFloating)&&void 0!==e&&e.enable)&&this.updateFloatingIcon();try{const e=n.contentDocument||n.contentWindow.document,t=e&&e.querySelectorAll(".moe-more-options");t&&0<t.length&&t.forEach((e=>e.style.display="none"))}catch(e){W.log(2,t,e)}}}createIFrame(){return je(this,void 0,void 0,(function*(){var e=Me.baseLogTag+".createIframe";W.log(1,e,"Creating new Iframe");try{W.log(1,e,"Creating Global Function for Iframe Usage"),window.cardAPI=Object.assign(Object.assign({},window.cardAPI),{cardsTabData:(e,t)=>this.getCardsTab(e,t),getErrorPage:e=>this.getErrorPage(e),closeCardsFrame:(e,t)=>this.closeIframe(t)}),null!=this&&this.cardHtmlCss&&(yield null==this?void 0:this.cardHtmlCss.init());var t=yield this.cardHtmlCss.cardFrame(),n=this.createDefaultIframe(N,t,this.cardsConfig);if("FRAMESET"===document.body.nodeName){const e=document.head;e.parentNode.insertBefore(n,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(n,e)}return W.log(1,e,"inbox Iframe Created and rendered"),n}catch(t){W.error(1,e,"Error initializing display manager:",t)}}))}createDefaultIframe(e,t,n){const r=document.createElement("iframe");return r.setAttribute("id",e),r.style.left="0px",r.style.top="0px",r.style.bottom="0px",r.style.right="0px",r.style.border="0px none",r.style.height="100%",r.style.width="100%",r.style.padding="0",r.style.overflow="hidden",r.style.overflowY="hidden",r.style.display="",r.style.position="fixed",e===N&&(r.style.transition="opacity 0.5s"),r.style.display="block",n?(({overLayColor:e,zIndex:n}=n),r.style.background=e,r.style.zIndex=n):r.style.background="transparent",r.setAttribute("srcdoc",t),r}}Me.baseLogTag="CardsRenderer";class ze{static setScrollState(e,t){document.body.style.overflow=t?"hidden":e.overflow}}class He{static get(e,t){return He.makeNetworkCall(Pe.METHODS.GET,e,t)}static post(e,t){return He.makeNetworkCall(Pe.METHODS.POST,e,t)}static makeNetworkCall(e,t,n={}){return new Promise(((r,i)=>{var o=JSON.stringify($(n,"postData",null));t=((e,t)=>{if(!t)return e;"?"!==e[e.length-1]&&(e+="?");for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return"&"===e[e.length-1]?e.slice(0,-1):e})(t,$(n,"queryParams",null));const a=new XMLHttpRequest;a.open(e,t,!0),He.addRequestHeaders(a,$(n,"headers",{})),a.onreadystatechange=()=>{4===a.readyState&&200===a.status||4===a.readyState&&410===a.status?r({status:a.status,responseText:a.responseText}):4===a.readyState&&200!==a.status&&i({code:a.status,reason:a.responseText})},a.send(o)}))}static addRequestHeaders(e,t){for(const n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e}}($e=($e=Pe=Pe||{}).METHODS||($e.METHODS={})).GET="GET",$e.POST="POST";var We=n(877),qe=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Ke{static getCards(e){return qe(this,void 0,void 0,(function*(){var t=Ke.baseLogTag+".getCards",n=yield se(),r=yield Ae.getAllCardIds(),i=yield we();r={headers:{"MOE-APPKEY":De().appId,"Content-Type":"application/json"},postData:{request_id:(0,We.v4)(),unique_id:n.uniqueId,identifiers:n.identifiers,card_category:e,platforms:[(n=navigator.userAgent.toLowerCase(),(/nexus player|neo-x5|adt-2|tsbnettv|roku|tizen|smart-tv.+(samsung)|hbbtv.+maple;(\d+)|(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))|(apple) ?tv|crkey|droid.+aft(\w)( bui|\))|\(dtv[\);].+(aquos)|(aquos-tv[\w ]+)\)|(bravia[\w ]+)( bui|\))|(mitv-\w{5}) bui|Hbbtv.*(technisat) (.*);|\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)|hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)|\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i.test(n)?g:"web")===g?"tv":"web")],last_updated_time:i||void 0,prev_sync_card_ids:r||void 0}};try{var o=yield He.post(""+De().baseDomainName+y,r),a=JSON.parse(o.responseText);return W.log(1,t,"Get Cards API call success, response: ",a),new Ae(a)}catch(n){W.error(1,t,"Error getting cards campaign list: ",n)}}))}static categoryFilter(e,t){return e.filter((e=>e.category===t))}static cardUpdate(e,t,n){return qe(this,void 0,void 0,(function*(){var r=Ke.baseLogTag+".cardUpdate";try{t=Array.isArray(t)?t:null==t?void 0:t.split(".");const s=se(),c=[];var i,o=yield Ae.get();let d=[];if(n)d=Ke.categoryFilter(o,n);else if(0<(null==t?void 0:t.length)){if(d=yield Promise.all(t.map((e=>qe(this,void 0,void 0,(function*(){return yield Le.getCardInfo(e)}))))),d=d.filter((e=>e)),e!==E&&d.length<t.length){const e=[];t.forEach((t=>{d.find((e=>e.id===t))||e.push(t)})),0<e.length&&W.warn(1,r,"Following cardIds do not exist in the storage - "+e)}}else d=o;if(e===E?(i=yield Le.getCardInfo(t[0]))&&!i.userActivity.is_clicked?c.push({card_id:t[0],is_clicked:!0}):i&&i.userActivity.is_clicked?W.log(1,r,`CardId: ${t[0]} is already clicked`):W.error(1,r,"Could not perform update. Card data not found in storage."):d.forEach((t=>{e===C?c.push({card_id:t.id,show_count:Le.getShowCount(t,s.uniqueId)+1,first_seen:t.userActivity.first_seen||(new Date).getTime()}):e!==_||t.userActivity.first_delivered||c.push({card_id:t.id,first_delivered:(new Date).getTime()})})),!c.length)return W.log(1,r,"No difference in previous and current data. Nothing to update."),!1;var a={headers:{"MOE-APPKEY":ne.get().appId,"Content-Type":"application/json"},postData:{request_id:(0,We.v4)(),unique_id:s.uniqueId,identifiers:s.identifiers,data:c}};try{return 200===(yield He.post(""+De().baseDomainName+I,a)).status?(yield Promise.all(c.map((e=>qe(this,void 0,void 0,(function*(){const t=e.card_id;yield Le.getCardInfo(t).then((n=>qe(this,void 0,void 0,(function*(){const r=Object.assign({},e);r.show_count&&(r.show_count=Object.assign(Object.assign({},n.userActivity.show_count),{[s.uniqueId]:r.show_count})),delete r.card_id,yield Le.setCardInfo(t,Object.assign(Object.assign({},n),{userActivity:Object.assign(Object.assign({},n.userActivity),r)}))}))))}))))),W.log(1,r,e+" successful"),!0):(W.error(1,r,e+" failed. Please try again"),!1)}catch(e){throw W.error(1,r,"Error updating card status: ",e),new Error("Could not update card status "+e)}}catch(e){throw W.error(1,r,"Error occurred in cardUpdate method: ",e),new Error("Error occurred in cardUpdate method - "+e)}}))}static deleteCard(e,t){return qe(this,void 0,void 0,(function*(){var t=Ke.baseLogTag+".deleteCard",n=yield Le.getCardInfo(e),{uid:r,uniqueId:i}=ae();if(!n)return W.error(1,t,"Card ID: "+e+" does not exist in campaigns DB"),!1;yield Le.removeCard(e);var o=e=>Array.isArray(e)?e:[e];const a={};e&&(a.card_ids=o(e)),i&&(a.unique_ids=o(i)),r&&(a.uids=o(r)),r={headers:{"MOE-APPKEY":De().appId,"Content-Type":"application/json"},postData:{request_id:(0,We.v4)(),data:[a]}};try{return 200===(yield He.post(""+De().baseDomainName+w,r)).status?(yield Le.removeCard(e),W.log(1,t,"Cards deleted for this user in remote. Deleting it from campaigns DB"),!0):(yield Le.setCardInfo(e,n),W.error(1,t,"Delete card operation failed, API returned non-200 status. Please try again"),!1)}catch(r){throw yield Le.setCardInfo(e,n),W.error(1,t,"Error updating card click status: ",r),new Error("Could not update card click status")}}))}}Ke.baseLogTag="CardsApi";var Ve=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const Ye="syncHelper";function Ge(){return Ve(this,void 0,void 0,(function*(){var e=Ye+".syncCampaigns";try{return(yield function(){return Ie(this,void 0,void 0,(function*(){return(yield function(){return Ie(this,void 0,void 0,(function*(){return yield Y.metaStore.getItem(v.LAST_FETCH_SDK_VERSION)}))}())!==xe().getSdkVersion()}))}())?(W.log(1,e,"New SDK version found. Clearing and fetching Card campaign "),yield Y.campaignStore.clear(),yield Je()):Qe(D)}catch(t){return void W.error(1,e,"Error syncing card campaigns: ",t)}}))}function Qe(e){return Ve(this,void 0,void 0,(function*(){var t=Ye+".checkCacheAndSaveRemote";try{return(yield function(e){return Ve(this,void 0,void 0,(function*(){var t=Ye+".isCachedCampaignExpired",n=yield we(),r=yield function(e){return Ve(this,void 0,void 0,(function*(){var t=yield Ne.get();if(t){if(e===D)return t.appOpen;if(e===k)return t.appInbox}return 2700}))}(e),i=(new Date).getTime();return null==n||1e3*r<i-n?(W.log(1,t,`Cache expired since ${e} event is set as ${r}s and last fetch happend at ${new Date(n)}.`),!0):(W.log(1,t,`Not fetching Cards from remote since last fetch was less than ${r}s ago at ${new Date(n)}.`),!1)}))}(e))||(yield function(){return Ve(this,void 0,void 0,(function*(){var e=yield Y.metaStore.getItem(v.UNIQUE_ID),t=te.get(i.USER_DATA);if(e&&e!==(null==t?void 0:t.deviceUuid))return W.log(1,"syncHelper.isUniqueIdChanged","Unique device id change detected. Will proceed to fetch latest cards campaigns"),!0}))}())?yield Je():void W.log(1,t,"Skipping fetching campaigns from remote bcoz: \n1. Cache is not expired. \n2. Device unique ID is not changed. \n3. SDK version has not been changed")}catch(e){W.error(1,t,"Error due to fail in: \n1. Checking cached campaignExpired. \n2. Checking if unique id changed. \n3. Saving the Remote Campaign.")}}))}function Je(){return Ve(this,void 0,void 0,(function*(){var e=yield Ke.getCards();e&&(yield function(e){return function(e,t,n,r){return new(n=n||Promise)((function(t,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var r;e.done?t(e.value):((r=e.value)instanceof n?r:new n((function(e){e(r)}))).then(o,a)}s((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){var t="databaseHelper.addCampaignsToDB";try{const{cards:n,deletedCardIds:r,cardCategories:i,syncIntervals:o,showAllTab:a}=e;yield Promise.all(n.map((e=>Y.campaignStore.setItem(e.id,e)))),W.log(1,t,`Adding/Updating ${n.length} cards campaigns in DB`,n.map((e=>e.id))),yield Promise.all(r.map((e=>Y.campaignStore.removeItem(e)))),W.log(1,t,`Removing ${r.length} cards campaigns from DB`,r.toString()),yield Y.metaStore.setItem(S,i),yield function(){return Ie(this,void 0,void 0,(function*(){yield Y.metaStore.setItem(v.LAST_FETCH_SDK_VERSION,xe().getSdkVersion())}))}(),yield Y.metaStore.setItem(v.SYNC_INTERVALS,o),yield Y.metaStore.setItem(v.SHOW_ALL_TAB,a),yield function(){return Ie(this,void 0,void 0,(function*(){return yield Y.metaStore.setItem(v.LAST_META_CALL_TIME,(new Date).getTime())}))}(),(new Me).updateFloatingIcon()}catch(e){W.error(1,t,"Error saving remote card campaigns:",e)}}))}(e.data),function(){Ve(this,void 0,void 0,(function*(){const e=yield Ae.get();return yield Ke.cardUpdate(_),e.forEach((e=>{if(!e.userActivity.first_delivered)return M().track_event(_,Object.assign({},e.metaData))}))}))}(),W.log(1,"syncHelper.saveRemoteCampaigns","Cards campaigns list saved!"))}))}var Xe=function(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};class Ze{constructor(){this.initializationPomise=null,this.displayManager=null,this.listeners={},this.boundIdentityUpdateHandler=this.identityUpdateHandler.bind(this)}initialize(e){const t=Ze.baseLogTag+".initialize";return null==this.initializationPomise&&(this.initializationPomise=new Promise((n=>Xe(this,void 0,void 0,(function*(){try{z.setRemoteLogging(e.configs.logLevel,e.configs.remoteLogTracking);var r=ne.get().cards;r.placeholder||W.warn(1,t,"Placeholder for cards inbox not passed while initializing the SDK. Considering as Self-Handled Cards. Config used: ",r),this.handleDisable(),this.displayManager=new Me,yield Y.initialize(),yield Ge(),yield this.displayManager.initialize(),W.log(2,t,"Cards module has been initialised"),this.handleSPA(),this.handleIdentityChange(),X.broadcastToWindow({topic:c,name:d.CARDS_INIT}),n(null)}catch(r){W.error(2,t,"Error in initialising Cards module ",r)}}))))),this.initializationPomise}handleDisable(){window.addEventListener(l,(e=>{e.detail.name===u.LOGOUT&&this.disableCardsModule()}))}refreshCards(){return Xe(this,void 0,void 0,(function*(){return yield Se(),yield Ge()}))}disableCardsModule(){return Xe(this,void 0,void 0,(function*(){yield this.logout(),M().cards=null}))}logout(){return Xe(this,void 0,void 0,(function*(){var e=Ze.baseLogTag+".logout";W.log(1,e,"Starting cards module logout"),this.initializationPomise=null,this.displayManager.closeIframe(!0),yield Y.clear(),this.displayManager.updateCardsData(),this.displayManager.updateFloatingIcon(),W.log(1,e,"Finishing cards module logout")}))}setLogLevel(e){W.setLogLevel(e),W.setLogTabStyle("#244DB5")}getUnClickedCardCount(){return Xe(this,void 0,void 0,(function*(){var e=Ze.baseLogTag+".getUnClickedCardCount";const t=yield Ae.getVisibleCards();let n=0;return t.forEach((e=>{null!==(e=e.userActivity)&&void 0!==e&&e.is_clicked||n++})),W.log(1,e,"Total number of UnClick Cards: ",n),n}))}getNewCardCount(){return Xe(this,void 0,void 0,(function*(){var e=Ze.baseLogTag+".getNewCardCount";const t=yield Ae.get();let n=0;return t.forEach((e=>{null!==(e=e.userActivity)&&void 0!==e&&e.first_seen||n++})),W.log(1,e,"Total number of new Cards: ",n),n}))}getVisibleNewCardCount(){return Xe(this,void 0,void 0,(function*(){var e=Ze.baseLogTag+".getVisibleNewCardCount";const t=yield Ae.getVisibleCards();let n=0;return t.forEach((e=>{null!==(e=e.userActivity)&&void 0!==e&&e.is_clicked||n++})),W.log(1,e,"Total number of new Cards: ",n),n}))}getCardsForCategory(e){return Xe(this,void 0,void 0,(function*(){var t=Ze.baseLogTag+".getCardsForCategory";let n=yield Ae.get();return n=n.filter((e=>"show"===e.status)),"All"===e||(n=n.filter((t=>t.category===e)),W.log(1,t,`Cards for category "${e}": `,n)),n}))}getVisibleCardsForCategory(e){return Xe(this,void 0,void 0,(function*(){var t=Ze.baseLogTag+".getVisibleCardsForCategory";const n=yield Ae.getVisibleCards();if("All"===e)return Ce(n);var r=n.filter((t=>t.category===e));return W.log(1,t,`Cards for category "${e}": `,r),Ce(r)}))}getCardCategories(){return Xe(this,void 0,void 0,(function*(){var e=Ze.baseLogTag+".getCardCategories",t=yield Ae.getCategories();return W.log(1,e,"Card categories fetched ",t),t}))}getCardsInfo(e){return Xe(this,void 0,void 0,(function*(){var t=Ze.baseLogTag+".getCardsInfo";if(e){var n=yield Le.getCardInfo(e);return W.log(1,t,`Card details for ${e} `,n),n}{let e=yield Ae.get();return e=e.filter((e=>"show"===e.status)),W.log(1,t,"All Cards info : ",e),e}}))}fetchCards(){return Xe(this,void 0,void 0,(function*(){var e=Ze.baseLogTag+".fetchCards";yield Qe(k);let t=yield Ae.get();return t.length&&(t=t.filter((e=>"show"===e.status)),W.log(1,e,"All Cards info : ",t)),t}))}inboxOpened(){return Xe(this,void 0,void 0,(function*(){return this.resetCards(k),xe().track_event(T)}))}cardShown(e){return Xe(this,void 0,void 0,(function*(){const t=Ze.baseLogTag+".cardShown";let n=[];return n=e?[e]:yield Ae.getAllCardIds(),yield Ke.cardUpdate(C,n),n.forEach((n=>Xe(this,void 0,void 0,(function*(){return this.getCardsInfo(n).then((e=>(W.log(1,t,"Card impression is tracked for ",e.id),xe().track_event(C,Object.assign({},e.metaData))))).catch((()=>{W.error(1,t,`CardId: ${e} Not Found`)}))}))))}))}cardClicked(e,t,n){return Xe(this,void 0,void 0,(function*(){const r=Ze.baseLogTag+".deleteCard";return yield Ke.cardUpdate(E,e),!1===n||this.getCardsInfo(e).then((e=>xe().track_event(E,Object.assign(Object.assign({},e.metaData),{widgetId:t})))).catch((()=>{W.error(1,r,`CardId: ${e} Not Found`)}))}))}deleteCard(e){return Xe(this,void 0,void 0,(function*(){const t=Ze.baseLogTag+".deleteCard";return this.getCardsInfo(e).then((t=>Xe(this,void 0,void 0,(function*(){return yield Ke.deleteCard(e),xe().track_event(x,Object.assign({},t.metaData))})))).catch((()=>{W.error(1,t,`CardId: ${e} Not Found`)}))}))}isAllCategoryEnabled(){return Xe(this,void 0,void 0,(function*(){return Ae.showAllTabs()}))}setInboxOpenListener(e){return Xe(this,void 0,void 0,(function*(){this.listeners[R]=e}))}setInboxCloseListener(e){return Xe(this,void 0,void 0,(function*(){this.listeners[F]=e}))}setCardClickListener(e){return Xe(this,void 0,void 0,(function*(){this.listeners[U]=e}))}updatePushBannerHeight(e,t){var n=document.querySelector("#"+N);if(n){const i=(null==n?void 0:n.contentDocument)||(null===(r=null==n?void 0:n.contentWindow)||void 0===r?void 0:r.document);var r=i.getElementById(P);!r&&t&&i.body.insertBefore(t.cloneNode(!0),i.getElementById(O)),r&&(i.getElementById(P).style.height=(null==e?void 0:e.toString())+"px"||0)}}handleSPA(){window.addEventListener("SPA",(e=>{"PAGE_CHANGED"===e.detail.name&&(this.resetCards(D),this.displayManager.closeIframe(),this.displayManager.addCardsInboxListener())}))}handleIdentityChange(){removeEventListener(l,this.boundIdentityUpdateHandler),window.addEventListener(l,this.boundIdentityUpdateHandler)}identityUpdateHandler(e){return Xe(this,void 0,void 0,(function*(){e.detail.name===u.USER_IDENTITY_UPDATE&&(yield Se(),this.resetCards(D))}))}resetCards(e){Qe(e)}}Ze.baseLogTag="MoeCards",window.moeCards=Ze})()})();