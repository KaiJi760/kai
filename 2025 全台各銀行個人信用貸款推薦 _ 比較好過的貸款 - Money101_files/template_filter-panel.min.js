mhg.filterPanel={scope:null,init:async function(scope){this.scope=scope;const filterPanel=scope.querySelector('[data-property-name="filter-panel"]'),isPageSwitcher="true"===filterPanel.getAttribute("data-property-page-switcher"),enablePlCalculation=(filterPanel.getAttribute("data-property-personal-loan-filter"),"true"===filterPanel.getAttribute("data-property-enable-pl-calculation")),showPlCalculationWidget="true"===filterPanel.getAttribute("data-property-show-pl-calculation-widget");window.addEventListener("scroll",(function(){const containerListing=scope.querySelector('[data-property-name="container-listing"]'),typeMenu=scope.querySelector('[data-property-name="type-menu"]'),stickyFilterPanel=scope.querySelector('[data-property-name="sticky-filter-panel"]'),rectFilterPanel=filterPanel.getBoundingClientRect();if(isPageSwitcher)if(rectFilterPanel.bottom>0){stickyFilterPanel.classList.add("hidden"),stickyFilterPanel.classList.remove("block"),stickyFilterPanel.style.top=containerListing.offsetHeight+typeMenu.offsetHeight+"px";const stickyControlPanel=scope.querySelector('[data-property-name="sticky-control-panel"]'),stickyFilterContainer=scope.querySelector('[data-property-name="sticky-filter-container"]');stickyControlPanel.classList.add("hidden"),stickyFilterContainer.classList.add("tws-pb-1")}else stickyFilterPanel.classList.remove("hidden"),stickyFilterPanel.classList.add("block"),stickyFilterPanel.style.top=containerListing.offsetHeight+typeMenu.offsetHeight+"px"}));const btnShowControlPanel=scope.querySelector('[data-property-name="btn-show-control-panel"]');btnShowControlPanel&&btnShowControlPanel.addEventListener("click",mhg.filterPanel.showControlPanel);const btnCloseControlPanel=scope.querySelector('[data-property-name="btn-close-control-panel"]');btnCloseControlPanel&&btnCloseControlPanel.addEventListener("click",mhg.filterPanel.closeControlPanel);const btnLoanTenures=scope.querySelectorAll('[data-property-name="btn-loan-tenure"]');for(let i=0;i<btnLoanTenures.length;i++){btnLoanTenures[i].addEventListener("click",mhg.filterPanel.handleBtnLoanTenure)}const btnLoanAmounts=scope.querySelectorAll('[data-property-name="btn-loan-amount"]');for(let i=0;i<btnLoanAmounts.length;i++){btnLoanAmounts[i].addEventListener("click",mhg.filterPanel.handleBtnLoanAmount)}if(null!==window.__graphql_endpoints__&&void 0!==window.__graphql_endpoints__){const mainResultLists=document.querySelectorAll('[data-module-id="results-page-product-list"]');for(let i=0;i<mainResultLists.length;i++){const mainResultList=mainResultLists[i];if("true"===mainResultList.getAttribute("data-property-filter-enabled")){const listFilter=filterPanel.querySelector('[data-property-name="list-filter"]');listFilter&&(listFilter.classList.remove("hidden"),listFilter.classList.add("md:hidden"));const stickyFilterPanel=scope.querySelector('[data-property-name="sticky-filter-panel"]');if(stickyFilterPanel){const stickyListFilter=stickyFilterPanel.querySelector('[data-property-name="list-filter"]');stickyListFilter.classList.remove("hidden"),stickyListFilter.classList.add("md:hidden")}}mhg.filterPanel.checkEnabledNewPlFilter()?enablePlCalculation&&mhg.filterPanel.setLoanResult(filterPanel,mainResultList):isPageSwitcher?await mhg.filterPanel.loanResult({tenureInMonths:mainResultList.getAttribute("data-property-filter-tenure-months"),principalAmount:mainResultList.getAttribute("data-property-filter-loan-amount")}):("true"===filterPanel.getAttribute("data-property-filter-default-loan-amount")&&mhg.filterPanel.setLoanResult(filterPanel,mainResultList),filterPanel.hasAttribute("data-property-is-provider-filter-panel")||mhg.filterPanel.setLoanResult(filterPanel,mainResultList))}}else console.error("please set endpoint value");mhg.filterPanel.checkEnabledNewPlFilter()?enablePlCalculation&&showPlCalculationWidget&&mhg.filterPanel.observerCallback(filterPanel):isPageSwitcher||mhg.filterPanel.observerCallback(filterPanel)},setLoanResult:async function(firstSelector,secondSelector){const loanAmountValue=firstSelector.getAttribute("data-property-filter-default-loan-amount"),loanTenureValue=firstSelector.getAttribute("data-property-filter-default-tenure"),defaultDisplayAsYear=firstSelector.getAttribute("data-property-display-as-year");secondSelector.setAttribute("data-property-filter-loan-amount",loanAmountValue),secondSelector.setAttribute("data-property-filter-tenure-months",loanTenureValue),secondSelector.setAttribute("data-property-display-as-year",defaultDisplayAsYear),await mhg.filterPanel.loanResult({tenureInMonths:secondSelector.getAttribute("data-property-filter-tenure-months"),principalAmount:secondSelector.getAttribute("data-property-filter-loan-amount")})},checkEnabledNewPlFilter:function(){const isEnabledNewPlFilter=new URLSearchParams(window.location.search).get("enablednewplfilter");return isEnabledNewPlFilter&&"true"===isEnabledNewPlFilter.toLowerCase()},showControlPanel:function(){const stickyFilterPanel=this.closest('[data-property-name="sticky-filter-panel"]'),stickyControlPanel=stickyFilterPanel.querySelector('[data-property-name="sticky-control-panel"]'),stickyFilterContainer=stickyFilterPanel.querySelector('[data-property-name="sticky-filter-container"]');stickyControlPanel&&stickyControlPanel.classList.remove("hidden"),stickyControlPanel&&stickyFilterContainer.classList.remove("tws-pb-1")},closeControlPanel:function(){const stickyFilterPanel=this.closest('[data-property-name="sticky-filter-panel"]'),stickyControlPanel=stickyFilterPanel.querySelector('[data-property-name="sticky-control-panel"]'),stickyFilterContainer=stickyFilterPanel.querySelector('[data-property-name="sticky-filter-container"]');stickyControlPanel&&stickyControlPanel.classList.add("hidden"),stickyControlPanel&&stickyFilterContainer.classList.add("tws-pb-1")},handleBtnLoanTenure:function(){let loanTenureValue=this.getAttribute("data-property-value");document.querySelectorAll('[data-property-name="btn-loan-tenure"]').forEach((btnLoanTenure=>{const isStickyBtn=btnLoanTenure.classList.contains("sticky-filter-btn");isStickyBtn?btnLoanTenure.classList.add("bg-white","text-gray-11"):btnLoanTenure.classList.add("bg-blue-9/30"),btnLoanTenure.classList.remove("bg-blue-9"),loanTenureValue==btnLoanTenure.getAttribute("data-property-value")&&(isStickyBtn?btnLoanTenure.classList.remove("bg-white","text-gray-11"):btnLoanTenure.classList.remove("bg-blue-9/30"),btnLoanTenure.classList.add("bg-blue-9"))})),this.classList.remove("bg-blue-9/30"),this.classList.add("bg-blue-9");const filterTextLoanTenures=document.querySelectorAll('[data-property-name="filter-text-loan-tenure"]');for(let i=0;i<filterTextLoanTenures.length;i++){filterTextLoanTenures[i].value=loanTenureValue}document.querySelectorAll('[data-property-name="filter-header-tenure-label"]').forEach((labelTenure=>{labelTenure.innerText=loanTenureValue}));const filterPanel=this.closest('[data-property-name="filter-panel"]');let displayAsYear=!1;filterPanel&&(displayAsYear="true"===filterPanel.getAttribute("data-property-display-as-year"));const pageSwitcher=this.closest('[data-property-name="page-switcher"]');if(pageSwitcher&&(displayAsYear="true"===pageSwitcher.getAttribute("data-property-display-as-year")),displayAsYear){loanTenureValue*=12}document.querySelector('[data-module-id="results-page-product-list"]').setAttribute("data-property-filter-tenure-months",loanTenureValue)},handleBtnLoanAmount:function(){const loanAmountValue=this.getAttribute("data-property-value");document.querySelectorAll('[data-property-name="btn-loan-amount"]').forEach((btnLoanAmount=>{const isStickyBtn=btnLoanAmount.classList.contains("sticky-filter-btn");isStickyBtn?btnLoanAmount.classList.add("bg-white","text-gray-11"):btnLoanAmount.classList.add("bg-blue-9/30"),btnLoanAmount.classList.remove("bg-blue-9"),loanAmountValue==btnLoanAmount.getAttribute("data-property-value")&&(isStickyBtn?btnLoanAmount.classList.remove("bg-white","text-gray-11"):btnLoanAmount.classList.remove("bg-blue-9/30"),btnLoanAmount.classList.add("bg-blue-9"))})),this.classList.remove("bg-blue-9/30"),this.classList.add("bg-blue-9");const filterTextLoanAmounts=document.querySelectorAll('[data-property-name="filter-text-loan-amount"]');for(let i=0;i<filterTextLoanAmounts.length;i++){const filterTextLoanAmount=filterTextLoanAmounts[i],numericValue=loanAmountValue.replace(/\D/g,""),formattedValue=Number(numericValue).toLocaleString();filterTextLoanAmount.value=formattedValue}document.querySelectorAll('[data-property-name="filter-header-loan-label"]').forEach((labelLoan=>{const numericValue=loanAmountValue.replace(/\D/g,""),formattedValue=Number(numericValue).toLocaleString();labelLoan.innerText=formattedValue}));document.querySelector('[data-module-id="results-page-product-list"]').setAttribute("data-property-filter-loan-amount",loanAmountValue)},loanResult:async function({principalAmount:principalAmount,tenureInMonths:tenureInMonths}){try{const requestHeaders=new Headers;requestHeaders.append("Content-Type","application/json");const productCards=document.querySelectorAll('div[data-property-name="productCard"]'),productIds=Array.from(productCards,(productCard=>productCard.getAttribute("data-property-product-id"))),chunks=[],chunkSize=25;for(let i=0;i<productIds.length;i+=chunkSize){const chunk=productIds.slice(i,i+chunkSize);chunks.push(chunk)}const finalResults=[];for(let i=0;i<chunks.length;i++){const chunk=chunks[i],requestOptions={method:"POST",headers:requestHeaders,body:JSON.stringify({id:window.__graphql_id__,variables:{productUids:chunk,input:{tenureInMonths:tenureInMonths,principalAmount:principalAmount}}}),redirect:"follow"},response=await fetch(window.__graphql_endpoints__,requestOptions),calculatePersonalLoans=(await response.json()).data.calculatePersonalLoans;for(let productIdx=0;productIdx<chunk.length;productIdx++){const productUid=chunk[productIdx],calculatePersonalLoan=calculatePersonalLoans[productIdx];finalResults.push({productUid:productUid,calculatePersonalLoan:calculatePersonalLoan})}}const productIdsToShow={};finalResults.forEach((function(product){const calculationResult=product.calculatePersonalLoan;if(calculationResult){productIdsToShow[product.productUid]=!0;document.querySelectorAll(`[data-property-name="productCard"][data-property-product-id="${product.productUid}"]`).forEach((productCard=>{productCard.removeAttribute("data-property-calculation-filter-hide");for(const[key,value]of Object.entries(calculationResult)){const attr=productCard.querySelector(`[data-attribute-type="${key}"]`);if(attr){let displayAttrPrefix="";const attrPrefix=attr.getAttribute("data-attribute-prefix");""!=attrPrefix&&(displayAttrPrefix=attrPrefix+" "),attr.querySelector('[data-property-name="attributeValue"]').innerText=displayAttrPrefix+value.replace("%","");if("NUMBER"==attr.getAttribute("data-attribute-format")){const formatDisplayTexts=parseFloat(value.replace("%",""));attr.querySelector('[data-property-name="attributeValue"]').innerText=displayAttrPrefix+formatDisplayTexts.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:4})}}if("INTERESTS"===key){const interestObj=calculationResult[key],flatRateInterval=interestObj.FLAT_RATE_INTERVAL,flatRateValue=interestObj.FLAT_RATE;if(flatRateInterval){const flatRateAttr=productCard.querySelector(`[data-attribute-type="${flatRateInterval}_FLAT_RATE"]`);flatRateAttr&&(flatRateAttr.querySelector('[data-property-name="attributeValue"]').innerText=flatRateValue.replace("%",""))}}}}))}else{const productCard=document.querySelector(`[data-property-name="productCard"][data-property-product-id="${product.productUid}"]`);"PL"===getVerticalCodeFromProductUid(product.productUid??"")&&productCard.setAttribute("data-property-calculation-filter-hide",!0)}}));const resultPageProductList=document.querySelector('[data-module-id="results-page-product-list"]');resultPageProductList.querySelectorAll('div[data-property-name="productCard"]').forEach((function(elem){const productId=elem.getAttribute("data-property-product-id"),verticalCode=getVerticalCodeFromProductUid(productId);productIdsToShow[productId]||"PL"!==verticalCode||elem.setAttribute("data-property-calculation-filter-hide",!0)}));const updateProductCardCount=resultPageProductList.parentNode,productCount=resultPageProductList.querySelectorAll('[data-property-name="productCard"]:not([data-property-list-filter-hide]):not([data-property-calculation-filter-hide])').length;updateProductCardCount.setAttribute("data-property-product-count",productCount)}catch(error){console.error(error.message)}},observerCallback:function(scope){const observer=new MutationObserver((async(mutationList,observer)=>{const mainResultList=document.querySelector('[data-module-id="results-page-product-list"]');for(const mutation of mutationList)if("attributes"===mutation.type)if("data-property-filter-loan-amount"==mutation.attributeName){const amount=mutation.target.attributes["data-property-filter-loan-amount"].value,textLoanAmountElements=document.querySelectorAll('[data-property-name="filter-text-loan-amount"]');for(let i=0;i<textLoanAmountElements.length;i++){const numericValue=amount.replace(/\D/g,""),formattedValue=Number(numericValue).toLocaleString();textLoanAmountElements[i].value=formattedValue}await mhg.filterPanel.loanResult({tenureInMonths:mainResultList.getAttribute("data-property-filter-tenure-months"),principalAmount:amount})}else if("data-property-filter-tenure-months"==mutation.attributeName){let tenure=mutation.target.attributes["data-property-filter-tenure-months"].value;await mhg.filterPanel.loanResult({tenureInMonths:tenure,principalAmount:mainResultList.getAttribute("data-property-filter-loan-amount")});if("true"===mainResultList.getAttribute("data-property-display-as-year")){tenure/=12}const textLoanTenureElements=document.querySelectorAll('[data-property-name="filter-text-loan-tenure"]');for(let i=0;i<textLoanTenureElements.length;i++)textLoanTenureElements[i].value=tenure}})),config={attributes:!0,childList:!1,subtree:!1},defaultLoanAmount=scope.getAttribute("data-property-filter-default-loan-amount"),defaultTenure=scope.getAttribute("data-property-filter-default-tenure"),defaultDisplayAsYear=scope.getAttribute("data-property-display-as-year"),mainResultList=document.querySelector('[data-module-id="results-page-product-list"]');mainResultList&&(mainResultList.setAttribute("data-property-filter-loan-amount",defaultLoanAmount),mainResultList.setAttribute("data-property-filter-tenure-months",defaultTenure),mainResultList.setAttribute("data-property-display-as-year",defaultDisplayAsYear),observer.observe(mainResultList,config))}};
//# sourceURL=https://cdn1.hubspotusercontent-eu1.net/hub/25174313/hub_generated/template_assets/86936528589/1727773228843/global/modules/common/macros/filter-panel/filter-panel.js